<!DOCTYPE HTML>
<html>
<head>
    <title>图片处理工具 - 云云的工具箱</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
    <link rel="stylesheet" href="assets/css/main.css" />
    <style>
        .image-tool {
            max-width: 1000px;
            margin: 0 auto;
            padding: 20px;
        }
        #canvas-container {
            max-width: 100%;
            overflow: auto;
            margin: 20px 0;
            border: 2px dashed #ccc;
            min-height: 400px;
        }
        canvas {
            display: block;
            margin: 0 auto;
        }
        .tool-controls {
            margin: 20px 0;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
        }
        .size-controls {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        .size-controls input[type="number"] {
            width: 100px;
        }
    </style>
</head>
<body class="is-preload">
    <div id="page-wrapper">
        <!-- Header -->
        <section id="header">
            <h1><a href="index.html">云云的工具箱</a></h1>
            <nav id="nav">
                <ul>
                    <li><a href="index.html">首页</a></li>
                    <li class="current"><a href="切图工具.html">图片处理工具</a></li>
                </ul>
            </nav>
        </section>

        <!-- Main -->
        <section id="main">
            <div class="container">
                <div class="image-tool">
                    <header class="major">
                        <h2>图片处理工具</h2>
                    </header>
                    
                    <div class="tool-controls">
                        <input type="file" id="imageInput" accept="image/*" class="button alt" />
                        <button id="cropBtn" class="button">裁剪</button>
                        <button id="resetBtn" class="button alt">重置</button>
                        <div class="size-controls">
                            <label>宽度:</label>
                            <input type="number" id="widthInput" placeholder="宽度" />
                            <label>高度:</label>
                            <input type="number" id="heightInput" placeholder="高度" />
                            <button id="resizeBtn" class="button">调整大小</button>
                        </div>
                        <button id="saveBtn" class="button primary">保存图片</button>
                    </div>

                    <div id="canvas-container">
                        <canvas id="imageCanvas"></canvas>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <!-- Scripts -->
    <script src="assets/js/jquery.min.js"></script>
    <script src="assets/js/browser.min.js"></script>
    <script src="assets/js/breakpoints.min.js"></script>
    <script src="assets/js/util.js"></script>
    <script src="assets/js/main.js"></script>
    <script>
        let canvas = document.getElementById('imageCanvas');
        let ctx = canvas.getContext('2d');
        let originalImage = null;
        let isDrawing = false;
        let startX, startY, cropX, cropY, cropWidth, cropHeight;

        // 加载图片
        document.getElementById('imageInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(event) {
                    const img = new Image();
                    img.onload = function() {
                        originalImage = img;
                        resetCanvas();
                    };
                    img.src = event.target.result;
                };
                reader.readAsDataURL(file);
            }
        });

        // 重置画布
        function resetCanvas() {
            if (originalImage) {
                canvas.width = originalImage.width;
                canvas.height = originalImage.height;
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                ctx.drawImage(originalImage, 0, 0);
                document.getElementById('widthInput').value = originalImage.width;
                document.getElementById('heightInput').value = originalImage.height;
            }
        }

        // 裁剪功能
        canvas.addEventListener('mousedown', function(e) {
            if (!originalImage) return;
            const rect = canvas.getBoundingClientRect();
            startX = e.clientX - rect.left;
            startY = e.clientY - rect.top;
            isDrawing = true;
        });

        canvas.addEventListener('mousemove', function(e) {
            if (!isDrawing) return;
            const rect = canvas.getBoundingClientRect();
            const currentX = e.clientX - rect.left;
            const currentY = e.clientY - rect.top;

            resetCanvas();
            ctx.strokeStyle = '#000';
            ctx.lineWidth = 2;
            ctx.setLineDash([5, 5]);
            
            cropX = Math.min(startX, currentX);
            cropY = Math.min(startY, currentY);
            cropWidth = Math.abs(currentX - startX);
            cropHeight = Math.abs(currentY - startY);
            
            ctx.strokeRect(cropX, cropY, cropWidth, cropHeight);
        });

        canvas.addEventListener('mouseup', function() {
            isDrawing = false;
        });

        // 执行裁剪
        document.getElementById('cropBtn').addEventListener('click', function() {
            if (!cropWidth || !cropHeight) return;
            
            const tempCanvas = document.createElement('canvas');
            tempCanvas.width = cropWidth;
            tempCanvas.height = cropHeight;
            const tempCtx = tempCanvas.getContext('2d');
            
            tempCtx.drawImage(canvas, cropX, cropY, cropWidth, cropHeight, 0, 0, cropWidth, cropHeight);
            
            const newImage = new Image();
            newImage.onload = function() {
                originalImage = newImage;
                resetCanvas();
            };
            newImage.src = tempCanvas.toDataURL();
        });

        // 调整大小
        document.getElementById('resizeBtn').addEventListener('click', function() {
            if (!originalImage) return;
            
            const newWidth = parseInt(document.getElementById('widthInput').value);
            const newHeight = parseInt(document.getElementById('heightInput').value);
            
            if (newWidth > 0 && newHeight > 0) {
                const tempCanvas = document.createElement('canvas');
                tempCanvas.width = newWidth;
                tempCanvas.height = newHeight;
                const tempCtx = tempCanvas.getContext('2d');
                
                tempCtx.drawImage(originalImage, 0, 0, newWidth, newHeight);
                
                const newImage = new Image();
                newImage.onload = function() {
                    originalImage = newImage;
                    resetCanvas();
                };
                newImage.src = tempCanvas.toDataURL();
            }
        });

        // 重置
        document.getElementById('resetBtn').addEventListener('click', resetCanvas);

        // 保存图片
        document.getElementById('saveBtn').addEventListener('click', function() {
            if (!originalImage) return;
            
            const link = document.createElement('a');
            link.download = 'processed_image.png';
            link.href = canvas.toDataURL();
            link.click();
        });
    </script>
</body>
</html>
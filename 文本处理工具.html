<!DOCTYPE html>
<html>
<head>
    <title>文本处理工具 - 云云的AI工具箱</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
    <link rel="stylesheet" href="assets/css/main.css" />
    <style>
        .text-tool {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .tool-section {
            background: #ffffff;
            border: 1px solid #ddd;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .text-area {
            width: 100%;
            min-height: 200px;
            padding: 15px;
            border: 1px solid #ccc;
            border-radius: 4px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            resize: vertical;
        }
        .tool-controls {
            margin: 15px 0;
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            align-items: center;
        }
        .tool-controls input[type="text"], .tool-controls input[type="number"] {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        .tool-controls label {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 14px;
            color: #333;
        }
        .tool-controls h4 {
            margin: 0 0 10px 0;
            color: #007acc;
            font-size: 16px;
            width: 100%;
        }
        .control-group {
            display: flex;
            gap: 10px;
            align-items: center;
            margin: 5px 0;
        }
        .result-area {
            background: #f9f9f9;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 15px;
            min-height: 100px;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            white-space: pre-wrap;
        }
        .stats {
            background: #e8f4f8;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
            font-size: 14px;
        }
        select, input[type="number"] {
            padding: 5px;
            border: 1px solid #ccc;
            border-radius: 4px;
        }
        .tab-container {
            margin: 20px 0;
        }
        .tab-buttons {
            display: flex;
            border-bottom: 2px solid #ddd;
            margin-bottom: 20px;
        }
        .tab-button {
            padding: 10px 20px;
            background: #f5f5f5;
            border: none;
            cursor: pointer;
            border-top: 2px solid transparent;
            color: #333 !important;
            font-weight: 500;
            transition: all 0.3s ease;
            border-radius: 4px 4px 0 0;
            text-decoration: none;
        }
        .tab-button:hover {
            background: #e8e8e8;
            color: #007acc !important;
        }
        .tab-button.active {
            background: #fff;
            border-top: 2px solid #007acc;
            color: #007acc !important;
            font-weight: bold;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        
        /* 复选框样式优化 */
        .tool-controls label {
            display: inline-flex;
            align-items: center;
            margin-right: 15px;
            cursor: pointer;
            user-select: none;
            position: relative;
        }
        
        .tool-controls input[type="checkbox"] {
            appearance: none;
            -webkit-appearance: none;
            -moz-appearance: none;
            width: 18px;
            height: 18px;
            border: 2px solid #ccc;
            border-radius: 3px;
            margin-right: 8px;
            position: relative;
            cursor: pointer;
            transition: all 0.3s ease;
            background: #fff;
        }
        
        .tool-controls input[type="checkbox"]:hover {
            border-color: #007acc;
            box-shadow: 0 0 5px rgba(0, 122, 204, 0.3);
        }

        .error-message {
            background: #fee;
            color: #c33;
            padding: 10px 15px;
            border-radius: 8px;
            margin: 10px 0;
            border-left: 4px solid #c33;
        }

        .success-message {
            background: #efe;
            color: #3c3;
            padding: 10px 15px;
            border-radius: 8px;
            margin: 10px 0;
            border-left: 4px solid #3c3;
        }
        
        .tool-controls input[type="checkbox"]:checked {
            background: #007acc;
            border-color: #007acc;
            box-shadow: 0 0 8px rgba(0, 122, 204, 0.4);
        }
        
        .tool-controls input[type="checkbox"]:checked::after {
            content: '✓';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            color: white;
            font-size: 12px;
            font-weight: bold;
        }
        
        .tool-controls input[type="checkbox"]:focus {
            outline: none;
            border-color: #007acc;
            box-shadow: 0 0 0 3px rgba(0, 122, 204, 0.2);
        }
        
        /* 复选框标签文字样式 */
        .tool-controls label:hover {
            color: #007acc;
        }
        
        .tool-controls input[type="checkbox"]:checked + span,
        .tool-controls label:has(input[type="checkbox"]:checked) {
            color: #007acc;
            font-weight: 500;
        }
    </style>
</head>
<body class="is-preload">
    <div id="page-wrapper">
        <!-- Header -->
        <section id="header">
            <h1><a href="index.html">云云的AI工具箱</a></h1>
            <nav id="nav">
                <ul>
                    <li><a href="index.html">主页</a></li>
                    <li class="current"><a href="文本处理工具.html">文本处理工具</a></li>
                    <li><a href="图片压缩工具.html">图片压缩</a></li>
                    <li><a href="格式转换工具.html">格式转换</a></li>
                    <li><a href="音频处理工具.html">音频处理</a></li>
                    <li><a href="视频处理工具.html">视频处理</a></li>
                    <li><a href="pdf工具集.html">PDF工具</a></li>
                </ul>
            </nav>
        </section>

        <!-- Main -->
        <section id="main">
            <div class="container">
                <div class="text-tool">
                    <header class="major">
                        <h2>文本处理工具</h2>
                        <p>提供文本格式化、转换、翻译等多种文本处理功能</p>
                    </header>
                    
                    <!-- 输入区域 -->
                    <div class="tool-section">
                        <h3>输入文本</h3>
                        <textarea id="inputText" class="text-area" placeholder="请在此输入或粘贴您要处理的文本..."></textarea>
                        <div class="tool-controls">
                            <button id="clearBtn" class="button alt">清空</button>
                            <button id="pasteBtn" class="button alt">粘贴</button>
                            <button id="copyInputBtn" class="button alt">复制</button>
                            <input type="file" id="fileInput" accept=".txt" style="display: none;">
                            <button id="loadFileBtn" class="button alt">加载文件</button>
                        </div>
                        <div class="stats" id="textStats">
                            字符数: 0 | 单词数: 0 | 行数: 0
                        </div>
                    </div>

                    <!-- 功能选项卡 -->
                    <div class="tab-container">
                        <div class="tab-buttons">
                            <button class="tab-button active" data-tab="format">格式化</button>
                            <button class="tab-button" data-tab="convert">转换</button>
                            <button class="tab-button" data-tab="translate">翻译</button>
                            <button class="tab-button" data-tab="analyze">分析</button>
                            <button class="tab-button" data-tab="regex">正则匹配</button>
                            <button class="tab-button" data-tab="generate">生成工具</button>
                        </div>

                        <!-- 格式化功能 -->
                        <div class="tab-content active" id="format">
                            <div class="tool-section">
                                <h3>文本格式化</h3>
                                <div class="tool-controls">
                                    <button id="trimBtn" class="button">去除首尾空格</button>
                                    <button id="removeExtraSpacesBtn" class="button">去除多余空格</button>
                                    <button id="removeEmptyLinesBtn" class="button">去除空行</button>
                                    <button id="addLineNumbersBtn" class="button">添加行号</button>
                                </div>
                                <div class="tool-controls">
                                    <button id="uppercaseBtn" class="button">转大写</button>
                                    <button id="lowercaseBtn" class="button">转小写</button>
                                    <button id="titleCaseBtn" class="button">标题格式</button>
                                    <button id="reverseBtn" class="button">反转文本</button>
                                </div>
                            </div>
                        </div>

                        <!-- 转换功能 -->
                        <div class="tab-content" id="convert">
                            <div class="tool-section">
                                <h3>文本转换</h3>
                                <div class="control-group">
                                    <label>编码转换:</label>
                                    <select id="encodingSelect">
                                        <option value="base64">Base64编码</option>
                                        <option value="url">URL编码</option>
                                        <option value="html">HTML实体编码</option>
                                        <option value="unicode">Unicode编码</option>
                                    </select>
                                    <button id="encodeBtn" class="button">编码</button>
                                    <button id="decodeBtn" class="button">解码</button>
                                </div>
                                <div class="control-group">
                                    <label>分隔符替换:</label>
                                    <input type="text" id="oldSeparator" placeholder="原分隔符" style="width: 100px;">
                                    <span>→</span>
                                    <input type="text" id="newSeparator" placeholder="新分隔符" style="width: 100px;">
                                    <button id="replaceSeparatorBtn" class="button">替换</button>
                                </div>
                                <div class="control-group">
                                    <button id="jsonFormatBtn" class="button">JSON格式化</button>
                                    <button id="jsonMinifyBtn" class="button">JSON压缩</button>
                                    <button id="csvToJsonBtn" class="button">CSV转JSON</button>
                                </div>
                            </div>
                        </div>

                        <!-- 翻译功能 -->
                        <div class="tab-content" id="translate">
                            <div class="tool-section">
                                <h3>文本翻译</h3>
                                <div class="control-group">
                                    <label>从:</label>
                                    <select id="fromLang">
                                        <option value="auto">自动检测</option>
                                        <option value="zh">中文</option>
                                        <option value="en">英文</option>
                                        <option value="ja">日文</option>
                                        <option value="ko">韩文</option>
                                        <option value="fr">法文</option>
                                        <option value="de">德文</option>
                                        <option value="es">西班牙文</option>
                                    </select>
                                    <label>到:</label>
                                    <select id="toLang">
                                        <option value="zh">中文</option>
                                        <option value="en">英文</option>
                                        <option value="ja">日文</option>
                                        <option value="ko">韩文</option>
                                        <option value="fr">法文</option>
                                        <option value="de">德文</option>
                                        <option value="es">西班牙文</option>
                                    </select>
                                    <button id="translateBtn" class="button primary">翻译</button>
                                </div>
                                <p style="color: #666; font-size: 12px;">注意: 翻译功能需要网络连接，使用第三方翻译服务</p>
                            </div>
                        </div>

                        <!-- 分析功能 -->
                        <div class="tab-content" id="analyze">
                            <div class="tool-section">
                                <h3>文本分析</h3>
                                <div class="tool-controls">
                                    <button id="analyzeBtn" class="button primary">开始分析</button>
                                    <button id="wordFrequencyBtn" class="button">词频统计</button>
                                    <button id="readabilityBtn" class="button">可读性分析</button>
                                    <button id="duplicateLineBtn" class="button">重复行检测</button>
                                </div>
                                <div id="analysisResult" class="result-area" style="margin-top: 15px;"></div>
                            </div>
                        </div>

                        <!-- 正则匹配功能 -->
                        <div class="tab-content" id="regex">
                            <div class="tool-section">
                                <h3>正则表达式匹配</h3>
                                <div class="tool-controls">
                                    <input type="text" id="regexPattern" placeholder="输入正则表达式" style="width: 300px; margin-right: 10px;">
                                    <label><input type="checkbox" id="regexGlobal" checked> 全局匹配</label>
                                    <label><input type="checkbox" id="regexIgnoreCase"> 忽略大小写</label>
                                </div>
                                <div class="tool-controls" style="margin-top: 10px;">
                                    <button id="regexMatchBtn" class="button primary">查找匹配</button>
                                    <button id="regexReplaceBtn" class="button">替换</button>
                                    <input type="text" id="replaceText" placeholder="替换文本" style="width: 200px; margin-left: 10px;">
                                </div>
                                <div class="tool-controls" style="margin-top: 10px;">
                                    <button id="emailExtractBtn" class="button">提取邮箱</button>
                                    <button id="phoneExtractBtn" class="button">提取电话</button>
                                    <button id="urlExtractBtn" class="button">提取URL</button>
                                    <button id="ipExtractBtn" class="button">提取IP地址</button>
                                </div>
                            </div>
                        </div>

                        <!-- 生成工具功能 -->
                        <div class="tab-content" id="generate">
                            <div class="tool-section">
                                <h3>文本生成工具</h3>
                                <div class="tool-controls">
                                    <h4>密码生成器</h4>
                                    <label>长度: <input type="number" id="passwordLength" value="12" min="4" max="50" style="width: 60px;"></label>
                                    <label><input type="checkbox" id="includeUppercase" checked> 大写字母</label>
                                    <label><input type="checkbox" id="includeLowercase" checked> 小写字母</label>
                                    <label><input type="checkbox" id="includeNumbers" checked> 数字</label>
                                    <label><input type="checkbox" id="includeSymbols"> 特殊符号</label>
                                    <button id="generatePasswordBtn" class="button primary">生成密码</button>
                                </div>
                                <div class="tool-controls" style="margin-top: 15px;">
                                    <h4>随机文本生成</h4>
                                    <button id="generateUuidBtn" class="button">生成UUID</button>
                                    <button id="generateLoremBtn" class="button">生成Lorem文本</button>
                                    <button id="generateTimestampBtn" class="button">生成时间戳</button>
                                </div>
                                <div class="tool-controls" style="margin-top: 15px;">
                                    <h4>文本处理</h4>
                                    <button id="sortLinesBtn" class="button">行排序</button>
                                    <button id="shuffleLinesBtn" class="button">行随机排列</button>
                                    <button id="numberLinesBtn" class="button">添加行号</button>
                                    <button id="reverseTextBtn" class="button">文本反转</button>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- 结果区域 -->
                    <div class="tool-section">
                        <h3>处理结果</h3>
                        <div id="resultArea" class="result-area">处理结果将在此显示...</div>
                        <div class="tool-controls">
                            <button id="copyResultBtn" class="button primary">复制结果</button>
                            <button id="downloadBtn" class="button alt">下载文件</button>
                            <button id="clearResultBtn" class="button alt">清空结果</button>
                        </div>
                    </div>
                </div>
            </div>
        </section>
    </div>

    <!-- Scripts -->
    <script src="assets/js/jquery.min.js"></script>
    <script src="assets/js/browser.min.js"></script>
    <script src="assets/js/breakpoints.min.js"></script>
    <script src="assets/js/util.js"></script>
    <script src="assets/js/main.js"></script>
    <script>
        // 全局变量
        const inputText = document.getElementById('inputText');
        const resultArea = document.getElementById('resultArea');
        const textStats = document.getElementById('textStats');

        // 选项卡切换
        document.querySelectorAll('.tab-button').forEach(button => {
            button.addEventListener('click', function() {
                const tabId = this.getAttribute('data-tab');
                
                // 移除所有活动状态
                document.querySelectorAll('.tab-button').forEach(btn => btn.classList.remove('active'));
                document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
                
                // 添加活动状态
                this.classList.add('active');
                document.getElementById(tabId).classList.add('active');
            });
        });

        // 更新文本统计
        function updateStats() {
            const text = inputText.value;
            const charCount = text.length;
            const wordCount = text.trim() ? text.trim().split(/\s+/).length : 0;
            const lineCount = text.split('\n').length;
            
            textStats.textContent = `字符数: ${charCount} | 单词数: ${wordCount} | 行数: ${lineCount}`;
        }

        // 显示结果
        function showResult(result) {
            resultArea.textContent = result;
        }

        // 基础功能
        inputText.addEventListener('input', updateStats);

        document.getElementById('clearBtn').addEventListener('click', () => {
            inputText.value = '';
            updateStats();
        });

        document.getElementById('pasteBtn').addEventListener('click', async () => {
            try {
                const text = await navigator.clipboard.readText();
                inputText.value = text;
                updateStats();
            } catch (err) {
                alert('无法访问剪贴板，请手动粘贴');
            }
        });

        document.getElementById('copyInputBtn').addEventListener('click', async () => {
            try {
                await navigator.clipboard.writeText(inputText.value);
                showMessage('文本已复制到剪贴板！', 'success');
            } catch (err) {
                showMessage('复制失败，请手动复制', 'error');
            }
        });

        document.getElementById('copyResultBtn').addEventListener('click', async () => {
            try {
                await navigator.clipboard.writeText(resultArea.textContent);
                alert('结果已复制到剪贴板');
            } catch (err) {
                alert('复制失败');
            }
        });

        document.getElementById('clearResultBtn').addEventListener('click', () => {
            resultArea.textContent = '处理结果将在此显示...';
        });

        // 文件加载
        document.getElementById('loadFileBtn').addEventListener('click', () => {
            document.getElementById('fileInput').click();
        });

        document.getElementById('fileInput').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    inputText.value = e.target.result;
                    updateStats();
                };
                reader.readAsText(file);
            }
        });

        // 格式化功能
        document.getElementById('trimBtn').addEventListener('click', () => {
            const result = inputText.value.trim();
            showResult(result);
        });

        document.getElementById('removeExtraSpacesBtn').addEventListener('click', () => {
            const result = inputText.value.replace(/\s+/g, ' ');
            showResult(result);
        });

        document.getElementById('removeEmptyLinesBtn').addEventListener('click', () => {
            const result = inputText.value.replace(/^\s*\n/gm, '');
            showResult(result);
        });

        document.getElementById('addLineNumbersBtn').addEventListener('click', () => {
            const lines = inputText.value.split('\n');
            const result = lines.map((line, index) => `${index + 1}. ${line}`).join('\n');
            showResult(result);
        });

        document.getElementById('uppercaseBtn').addEventListener('click', () => {
            showResult(inputText.value.toUpperCase());
        });

        document.getElementById('lowercaseBtn').addEventListener('click', () => {
            showResult(inputText.value.toLowerCase());
        });

        document.getElementById('titleCaseBtn').addEventListener('click', () => {
            const result = inputText.value.replace(/\w\S*/g, (txt) => 
                txt.charAt(0).toUpperCase() + txt.substr(1).toLowerCase());
            showResult(result);
        });

        document.getElementById('reverseBtn').addEventListener('click', () => {
            showResult(inputText.value.split('').reverse().join(''));
        });

        // 编码转换功能
        document.getElementById('encodeBtn').addEventListener('click', () => {
            const encoding = document.getElementById('encodingSelect').value;
            const text = inputText.value;
            let result = '';

            try {
                switch(encoding) {
                    case 'base64':
                        result = btoa(unescape(encodeURIComponent(text)));
                        break;
                    case 'url':
                        result = encodeURIComponent(text);
                        break;
                    case 'html':
                        result = text.replace(/[&<>"']/g, function(m) {
                            return {'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[m];
                        });
                        break;
                    case 'unicode':
                        result = text.split('').map(char => 
                            '\\u' + ('0000' + char.charCodeAt(0).toString(16)).slice(-4)
                        ).join('');
                        break;
                }
                showResult(result);
            } catch (err) {
                showMessage('编码失败，请检查输入', 'error');
            }
        });

        document.getElementById('decodeBtn').addEventListener('click', () => {
            const encoding = document.getElementById('encodingSelect').value;
            const text = inputText.value;
            let result = '';

            try {
                switch(encoding) {
                    case 'base64':
                        result = decodeURIComponent(escape(atob(text)));
                        break;
                    case 'url':
                        result = decodeURIComponent(text);
                        break;
                    case 'html':
                        const div = document.createElement('div');
                        div.innerHTML = text;
                        result = div.textContent || div.innerText || '';
                        break;
                    case 'unicode':
                        result = text.replace(/\\u[\dA-F]{4}/gi, function(match) {
                            return String.fromCharCode(parseInt(match.replace(/\\u/g, ''), 16));
                        });
                        break;
                }
                showResult(result);
            } catch (err) {
                showMessage('解码失败，请检查输入格式', 'error');
            }
        });

        // 分隔符替换
        document.getElementById('replaceSeparatorBtn').addEventListener('click', () => {
            const oldSep = document.getElementById('oldSeparator').value;
            const newSep = document.getElementById('newSeparator').value;
            
            if (!oldSep) {
                showMessage('请输入原分隔符', 'error');
                return;
            }
            
            const result = inputText.value.split(oldSep).join(newSep);
            showResult(result);
        });

        // JSON处理
        document.getElementById('jsonFormatBtn').addEventListener('click', () => {
            try {
                const obj = JSON.parse(inputText.value);
                const result = JSON.stringify(obj, null, 2);
                showResult(result);
            } catch (err) {
                showMessage('JSON格式错误，请检查输入', 'error');
            }
        });

        document.getElementById('jsonMinifyBtn').addEventListener('click', () => {
            try {
                const obj = JSON.parse(inputText.value);
                const result = JSON.stringify(obj);
                showResult(result);
            } catch (err) {
                showMessage('JSON格式错误，请检查输入', 'error');
            }
        });

        // 翻译功能（模拟）
        document.getElementById('translateBtn').addEventListener('click', () => {
            const fromLang = document.getElementById('fromLang').value;
            const toLang = document.getElementById('toLang').value;
            const text = inputText.value;
            
            if (!text.trim()) {
                showMessage('请输入要翻译的文本', 'error');
                return;
            }
            
            // 这里应该调用真实的翻译API
            showResult('翻译功能需要集成第三方翻译服务API\n\n原文: ' + text + '\n\n译文: [翻译结果将在此显示]');
        });

        // 文本分析
        document.getElementById('analyzeBtn').addEventListener('click', () => {
            const text = inputText.value;
            const analysisResult = document.getElementById('analysisResult');
            
            if (!text.trim()) {
                showMessage('请输入要分析的文本', 'error');
                return;
            }
            
            const charCount = text.length;
            const wordCount = text.trim().split(/\s+/).length;
            const lineCount = text.split('\n').length;
            const paragraphCount = text.split(/\n\s*\n/).length;
            const avgWordsPerLine = (wordCount / lineCount).toFixed(2);
            
            analysisResult.innerHTML = `
                <h4>文本统计分析</h4>
                <p><strong>字符数:</strong> ${charCount}</p>
                <p><strong>单词数:</strong> ${wordCount}</p>
                <p><strong>行数:</strong> ${lineCount}</p>
                <p><strong>段落数:</strong> ${paragraphCount}</p>
                <p><strong>平均每行单词数:</strong> ${avgWordsPerLine}</p>
            `;
        });
        
        // 词频统计
        document.getElementById('wordFrequencyBtn').addEventListener('click', () => {
            const text = inputText.value.toLowerCase();
            const words = text.match(/\b\w+\b/g);
            
            if (!words) {
                showMessage('未找到有效单词', 'error');
                return;
            }
            
            const frequency = {};
            words.forEach(word => {
                frequency[word] = (frequency[word] || 0) + 1;
            });
            
            const sorted = Object.entries(frequency)
                .sort(([,a], [,b]) => b - a)
                .slice(0, 20);
            
            const analysisResult = document.getElementById('analysisResult');
            analysisResult.innerHTML = `
                <h4>词频统计 (前20个)</h4>
                ${sorted.map(([word, count]) => `<p>${word}: ${count}次</p>`).join('')}
            `;
        });
        
        // 重复行检测
        document.getElementById('duplicateLineBtn').addEventListener('click', () => {
            const lines = inputText.value.split('\n');
            const lineCount = {};
            const duplicates = [];
            
            lines.forEach((line, index) => {
                const trimmed = line.trim();
                if (trimmed) {
                    if (lineCount[trimmed]) {
                        lineCount[trimmed].push(index + 1);
                    } else {
                        lineCount[trimmed] = [index + 1];
                    }
                }
            });
            
            Object.entries(lineCount).forEach(([line, positions]) => {
                if (positions.length > 1) {
                    duplicates.push({line, positions});
                }
            });
            
            const analysisResult = document.getElementById('analysisResult');
            if (duplicates.length === 0) {
                analysisResult.innerHTML = '<h4>重复行检测</h4><p>未发现重复行</p>';
            } else {
                analysisResult.innerHTML = `
                    <h4>重复行检测</h4>
                    ${duplicates.map(({line, positions}) => 
                        `<p><strong>行 ${positions.join(', ')}:</strong> ${line}</p>`
                    ).join('')}
                `;
            }
        });
        
        // 正则匹配功能
        document.getElementById('regexMatchBtn').addEventListener('click', () => {
            const pattern = document.getElementById('regexPattern').value;
            const text = inputText.value;
            
            if (!pattern) {
                alert('请输入正则表达式');
                return;
            }
            
            try {
                const flags = (document.getElementById('regexGlobal').checked ? 'g' : '') +
                             (document.getElementById('regexIgnoreCase').checked ? 'i' : '');
                const regex = new RegExp(pattern, flags);
                const matches = text.match(regex);
                
                if (matches) {
                    showResult(`找到 ${matches.length} 个匹配:\n\n${matches.join('\n')}`);
                } else {
                    showResult('未找到匹配项');
                }
            } catch (err) {
                alert('正则表达式错误: ' + err.message);
            }
        });
        
        document.getElementById('regexReplaceBtn').addEventListener('click', () => {
            const pattern = document.getElementById('regexPattern').value;
            const replacement = document.getElementById('replaceText').value;
            const text = inputText.value;
            
            if (!pattern) {
                alert('请输入正则表达式');
                return;
            }
            
            try {
                const flags = (document.getElementById('regexGlobal').checked ? 'g' : '') +
                             (document.getElementById('regexIgnoreCase').checked ? 'i' : '');
                const regex = new RegExp(pattern, flags);
                const result = text.replace(regex, replacement);
                showResult(result);
            } catch (err) {
                alert('正则表达式错误: ' + err.message);
            }
        });
        
        // 提取功能
        document.getElementById('emailExtractBtn').addEventListener('click', () => {
            const emailRegex = /\b[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Z|a-z]{2,}\b/g;
            const matches = inputText.value.match(emailRegex);
            showResult(matches ? matches.join('\n') : '未找到邮箱地址');
        });
        
        document.getElementById('phoneExtractBtn').addEventListener('click', () => {
            const phoneRegex = /(?:\+?86)?\s*1[3-9]\d{9}|\(?\d{3}\)?[-\s]?\d{3}[-\s]?\d{4}/g;
            const matches = inputText.value.match(phoneRegex);
            showResult(matches ? matches.join('\n') : '未找到电话号码');
        });
        
        document.getElementById('urlExtractBtn').addEventListener('click', () => {
            const urlRegex = /https?:\/\/(www\.)?[-a-zA-Z0-9@:%._\+~#=]{1,256}\.[a-zA-Z0-9()]{1,6}\b([-a-zA-Z0-9()@:%_\+.~#?&//=]*)/g;
            const matches = inputText.value.match(urlRegex);
            showResult(matches ? matches.join('\n') : '未找到URL');
        });
        
        document.getElementById('ipExtractBtn').addEventListener('click', () => {
            const ipRegex = /\b(?:[0-9]{1,3}\.){3}[0-9]{1,3}\b/g;
            const matches = inputText.value.match(ipRegex);
            showResult(matches ? matches.join('\n') : '未找到IP地址');
        });
        
        // 密码生成
        document.getElementById('generatePasswordBtn').addEventListener('click', () => {
            const length = parseInt(document.getElementById('passwordLength').value);
            const includeUpper = document.getElementById('includeUppercase').checked;
            const includeLower = document.getElementById('includeLowercase').checked;
            const includeNumbers = document.getElementById('includeNumbers').checked;
            const includeSymbols = document.getElementById('includeSymbols').checked;
            
            let charset = '';
            if (includeUpper) charset += 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
            if (includeLower) charset += 'abcdefghijklmnopqrstuvwxyz';
            if (includeNumbers) charset += '0123456789';
            if (includeSymbols) charset += '!@#$%^&*()_+-=[]{}|;:,.<>?';
            
            if (!charset) {
                alert('请至少选择一种字符类型');
                return;
            }
            
            let password = '';
            for (let i = 0; i < length; i++) {
                password += charset.charAt(Math.floor(Math.random() * charset.length));
            }
            
            showResult(password);
        });
        
        // 其他生成工具
        document.getElementById('generateUuidBtn').addEventListener('click', () => {
            const uuid = 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
                const r = Math.random() * 16 | 0;
                const v = c == 'x' ? r : (r & 0x3 | 0x8);
                return v.toString(16);
            });
            showResult(uuid);
        });
        
        document.getElementById('generateLoremBtn').addEventListener('click', () => {
            const lorem = 'Lorem ipsum dolor sit amet, consectetur adipiscing elit, sed do eiusmod tempor incididunt ut labore et dolore magna aliqua. Ut enim ad minim veniam, quis nostrud exercitation ullamco laboris nisi ut aliquip ex ea commodo consequat. Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.';
            showResult(lorem);
        });
        
        document.getElementById('generateTimestampBtn').addEventListener('click', () => {
            const now = new Date();
            const timestamp = `Unix时间戳: ${Math.floor(now.getTime() / 1000)}\n当前时间: ${now.toLocaleString()}\nISO格式: ${now.toISOString()}`;
            showResult(timestamp);
        });
        
        // 文本处理工具
        document.getElementById('sortLinesBtn').addEventListener('click', () => {
            const lines = inputText.value.split('\n');
            const sorted = lines.sort();
            showResult(sorted.join('\n'));
        });
        
        document.getElementById('shuffleLinesBtn').addEventListener('click', () => {
            const lines = inputText.value.split('\n');
            for (let i = lines.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [lines[i], lines[j]] = [lines[j], lines[i]];
            }
            showResult(lines.join('\n'));
        });
        
        document.getElementById('numberLinesBtn').addEventListener('click', () => {
            const lines = inputText.value.split('\n');
            const numbered = lines.map((line, index) => `${index + 1}. ${line}`);
            showResult(numbered.join('\n'));
        });
        
        document.getElementById('reverseTextBtn').addEventListener('click', () => {
            const lines = inputText.value.split('\n');
            const reversed = lines.reverse();
            showResult(reversed.join('\n'));
        });
        
        // 可读性分析
        document.getElementById('readabilityBtn').addEventListener('click', () => {
            const text = inputText.value;
            const sentences = text.split(/[.!?]+/).filter(s => s.trim().length > 0);
            const words = text.match(/\b\w+\b/g) || [];
            const syllables = words.reduce((count, word) => {
                return count + Math.max(1, word.match(/[aeiouy]+/gi)?.length || 1);
            }, 0);
            
            const avgWordsPerSentence = words.length / sentences.length || 0;
            const avgSyllablesPerWord = syllables / words.length || 0;
            
            // 简化的可读性评分
            const readabilityScore = 206.835 - (1.015 * avgWordsPerSentence) - (84.6 * avgSyllablesPerWord);
            
            let level = '';
            if (readabilityScore >= 90) level = '非常容易';
            else if (readabilityScore >= 80) level = '容易';
            else if (readabilityScore >= 70) level = '较容易';
            else if (readabilityScore >= 60) level = '标准';
            else if (readabilityScore >= 50) level = '较难';
            else if (readabilityScore >= 30) level = '困难';
            else level = '非常困难';
            
            const analysisResult = document.getElementById('analysisResult');
            analysisResult.innerHTML = `
                <h4>可读性分析</h4>
                <p><strong>句子数:</strong> ${sentences.length}</p>
                <p><strong>平均每句单词数:</strong> ${avgWordsPerSentence.toFixed(2)}</p>
                <p><strong>平均每词音节数:</strong> ${avgSyllablesPerWord.toFixed(2)}</p>
                <p><strong>可读性评分:</strong> ${readabilityScore.toFixed(1)}</p>
                <p><strong>阅读难度:</strong> ${level}</p>
            `;
        });

        // 下载功能
        document.getElementById('downloadBtn').addEventListener('click', () => {
            const content = resultArea.textContent;
            if (content === '处理结果将在此显示...') {
                showMessage('没有可下载的内容', 'error');
                return;
            }
            
            const blob = new Blob([content], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'processed_text.txt';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        });

        // 显示消息函数
        function showMessage(message, type = 'info') {
            const messageDiv = document.createElement('div');
            messageDiv.className = type === 'error' ? 'error-message' : 'success-message';
            messageDiv.textContent = message;
            
            const container = document.querySelector('.container');
            container.insertBefore(messageDiv, container.firstChild);
            
            setTimeout(() => {
                messageDiv.remove();
            }, 5000);
        }

        // 初始化
        updateStats();
    </script>
</body>
</html>
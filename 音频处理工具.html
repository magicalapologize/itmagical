<!DOCTYPE HTML>
<html>
<head>
    <title>音频处理工具 - IT魔法师</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, user-scalable=no" />
    <link rel="stylesheet" href="assets/css/main.css" />
    <noscript><link rel="stylesheet" href="assets/css/noscript.css" /></noscript>
    <style>
        .audio-tool {
            background: #fff;
            border-radius: 10px;
            padding: 30px;
            margin: 20px 0;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .tool-tabs {
            display: flex;
            margin-bottom: 30px;
            border-bottom: 2px solid #f0f0f0;
        }
        
        .tab-button {
            padding: 15px 25px;
            background: #c2185b;
            border: 1px solid #ad1457;
            border-radius: 6px 6px 0 0;
            cursor: pointer;
            font-size: 16px;
            color: white;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
            margin-right: 2px;
        }
        
        .tab-button:hover {
            background: #ad1457;
            color: white;
        }
        
        .tab-button.active {
            background: #007acc;
            color: white;
            border-bottom-color: #007acc;
            font-weight: bold;
            border-color: #007acc;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .upload-area {
            border: 2px dashed #ddd;
            border-radius: 10px;
            padding: 40px;
            text-align: center;
            margin: 20px 0;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .upload-area:hover {
            border-color: #007acc;
            background: #f8f9fa;
        }
        
        .upload-area.dragover {
            border-color: #007acc;
            background: #e3f2fd;
        }
        
        .file-input {
            display: none;
        }
        
        .audio-controls {
            margin: 20px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
        }
        
        .control-group {
            margin: 15px 0;
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .control-group label {
            min-width: 120px;
            font-weight: bold;
        }
        
        .slider {
            flex: 1;
            height: 6px;
            border-radius: 3px;
            background: #ddd;
            outline: none;
            -webkit-appearance: none;
        }
        
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #007acc;
            cursor: pointer;
        }
        
        .progress-bar {
            width: 100%;
            height: 20px;
            background: #f0f0f0;
            border-radius: 10px;
            overflow: hidden;
            margin: 20px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #007acc, #00a8ff);
            width: 0%;
            transition: width 0.3s ease;
        }
        
        .result-area {
            margin: 20px 0;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            min-height: 100px;
            display: none;
        }
        
        .download-area {
            margin: 20px 0;
            text-align: center;
            display: none;
        }
        
        .error-message {
            background: #ffebee;
            color: #c62828;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            display: none;
        }
        
        .file-info {
            background: #e8f5e8;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            display: none;
        }
        
        .waveform-container {
            width: 100%;
            height: 150px;
            background: #f0f0f0;
            border-radius: 8px;
            margin: 20px 0;
            position: relative;
            overflow: hidden;
        }
        
        .waveform {
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, 
                transparent 0%, 
                rgba(0,122,204,0.3) 25%, 
                rgba(0,122,204,0.6) 50%, 
                rgba(0,122,204,0.3) 75%, 
                transparent 100%);
        }
        
        .time-markers {
            position: absolute;
            bottom: 5px;
            left: 0;
            right: 0;
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #666;
            padding: 0 10px;
        }
        
        .audio-player {
            width: 100%;
            margin: 20px 0;
        }
        
        .format-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .format-option {
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 8px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .format-option:hover {
            border-color: #007acc;
        }
        
        .format-option.selected {
            border-color: #007acc;
            background: #e3f2fd;
        }
        
        .enhancement-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .enhancement-card {
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            text-align: center;
        }
        
        .enhancement-card h4 {
            margin: 0 0 10px 0;
            color: #007acc;
        }
        
        .button {
            display: inline-block;
            padding: 12px 24px;
            background: #007acc;
            color: white;
            text-decoration: none;
            border-radius: 6px;
            border: none;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s ease;
            margin: 5px;
        }
        
        .button:hover {
            background: #005a9e;
            transform: translateY(-2px);
        }
        
        .button.secondary {
            background: #6c757d;
        }
        
        .button.secondary:hover {
            background: #545b62;
        }
        
        .button.success {
            background: #28a745;
        }
        
        .button.success:hover {
            background: #1e7e34;
        }
    </style>
</head>
<body class="is-preload">
    <!-- Wrapper -->
    <div id="wrapper">
        <!-- Header -->
        <header id="header">
            <h1><a href="index.html">IT魔法师</a></h1>
            <nav id="nav">
                <ul>
                    <li><a href="index.html">首页</a></li>
                    <li><a href="格式转换工具.html">格式转换</a></li>
                    <li><a href="文本处理工具.html">文本处理</a></li>
                    <li><a href="图片压缩工具.html">图片压缩</a></li>
                    <li class="current"><a href="音频处理工具.html">音频处理</a></li>
                    <li><a href="视频处理工具.html">视频处理</a></li>
                    <li><a href="pdf工具集.html">PDF工具</a></li>
                </ul>
            </nav>
        </header>

        <!-- Main -->
        <div id="main" class="wrapper style1">
            <div class="container">
                <header class="major">
                    <h2>音频处理工具</h2>
                    <p>专业的音频编辑和处理工具，支持剪辑、格式转换、音质增强等功能</p>
                </header>

                <div class="audio-tool">
                    <!-- 选项卡导航 -->
                    <div class="tool-tabs">
                        <button class="tab-button active" data-tab="edit">音频剪辑</button>
                        <button class="tab-button" data-tab="convert">格式转换</button>
                        <button class="tab-button" data-tab="enhance">音质增强</button>
                        <button class="tab-button" data-tab="effects">音效处理</button>
                        <button class="tab-button" data-tab="analysis">音频分析</button>
                    </div>

                    <!-- 文件上传区域 -->
                    <div class="upload-area" id="uploadArea">
                        <i class="fas fa-cloud-upload-alt" style="font-size: 48px; color: #007acc; margin-bottom: 20px;"></i>
                        <h3>拖拽音频文件到此处或点击选择</h3>
                        <p>支持 MP3、WAV、AAC、FLAC、OGG 等格式</p>
                        <input type="file" id="fileInput" class="file-input" accept="audio/*" multiple>
                    </div>

                    <!-- 错误信息 -->
                    <div id="errorMessage" class="error-message"></div>

                    <!-- 文件信息 -->
                    <div id="fileInfo" class="file-info"></div>

                    <!-- 音频播放器 -->
                    <audio id="audioPlayer" class="audio-player" controls style="display: none;"></audio>

                    <!-- 波形显示 -->
                    <div id="waveformContainer" class="waveform-container" style="display: none;">
                        <div class="waveform"></div>
                        <div class="time-markers">
                            <span>0:00</span>
                            <span>1:00</span>
                            <span>2:00</span>
                            <span>3:00</span>
                            <span>4:00</span>
                        </div>
                    </div>

                    <!-- 音频剪辑选项卡 -->
                    <div id="edit" class="tab-content active">
                        <h3>音频剪辑</h3>
                        <div class="audio-controls">
                            <div class="control-group">
                                <label>开始时间:</label>
                                <input type="range" id="startTime" class="slider" min="0" max="100" value="0">
                                <span id="startTimeValue">0:00</span>
                            </div>
                            <div class="control-group">
                                <label>结束时间:</label>
                                <input type="range" id="endTime" class="slider" min="0" max="100" value="100">
                                <span id="endTimeValue">0:00</span>
                            </div>
                            <div class="control-group">
                                <label>淡入时间:</label>
                                <input type="range" id="fadeIn" class="slider" min="0" max="5" value="0" step="0.1">
                                <span id="fadeInValue">0.0s</span>
                            </div>
                            <div class="control-group">
                                <label>淡出时间:</label>
                                <input type="range" id="fadeOut" class="slider" min="0" max="5" value="0" step="0.1">
                                <span id="fadeOutValue">0.0s</span>
                            </div>
                        </div>
                        <button class="button" onclick="trimAudio()">剪辑音频</button>
                        <button class="button secondary" onclick="previewTrim()">预览剪辑</button>
                    </div>

                    <!-- 格式转换选项卡 -->
                    <div id="convert" class="tab-content">
                        <h3>格式转换</h3>
                        <div class="format-options">
                            <div class="format-option" data-format="mp3">
                                <h4>MP3</h4>
                                <p>通用格式，文件小</p>
                            </div>
                            <div class="format-option" data-format="wav">
                                <h4>WAV</h4>
                                <p>无损格式，高质量</p>
                            </div>
                            <div class="format-option" data-format="aac">
                                <h4>AAC</h4>
                                <p>高效压缩，好音质</p>
                            </div>
                            <div class="format-option" data-format="flac">
                                <h4>FLAC</h4>
                                <p>无损压缩格式</p>
                            </div>
                            <div class="format-option" data-format="ogg">
                                <h4>OGG</h4>
                                <p>开源格式</p>
                            </div>
                        </div>
                        <div class="audio-controls">
                            <div class="control-group">
                                <label>音质:</label>
                                <select id="audioQuality">
                                    <option value="128">128 kbps (标准)</option>
                                    <option value="192">192 kbps (高质量)</option>
                                    <option value="256">256 kbps (很高质量)</option>
                                    <option value="320" selected>320 kbps (最高质量)</option>
                                </select>
                            </div>
                            <div class="control-group">
                                <label>采样率:</label>
                                <select id="sampleRate">
                                    <option value="22050">22.05 kHz</option>
                                    <option value="44100" selected>44.1 kHz (CD质量)</option>
                                    <option value="48000">48 kHz</option>
                                    <option value="96000">96 kHz (高保真)</option>
                                </select>
                            </div>
                        </div>
                        <button class="button" onclick="convertAudio()">转换格式</button>
                    </div>

                    <!-- 音质增强选项卡 -->
                    <div id="enhance" class="tab-content">
                        <h3>音质增强</h3>
                        <div class="enhancement-options">
                            <div class="enhancement-card">
                                <h4>降噪处理</h4>
                                <p>去除背景噪音</p>
                                <div class="control-group">
                                    <label>降噪强度:</label>
                                    <input type="range" id="noiseReduction" class="slider" min="0" max="100" value="50">
                                    <span id="noiseReductionValue">50%</span>
                                </div>
                                <button class="button" onclick="applyNoiseReduction()">应用降噪</button>
                            </div>
                            <div class="enhancement-card">
                                <h4>音量标准化</h4>
                                <p>统一音量大小</p>
                                <div class="control-group">
                                    <label>目标音量:</label>
                                    <input type="range" id="targetVolume" class="slider" min="-20" max="0" value="-3">
                                    <span id="targetVolumeValue">-3 dB</span>
                                </div>
                                <button class="button" onclick="normalizeVolume()">标准化音量</button>
                            </div>
                            <div class="enhancement-card">
                                <h4>动态范围压缩</h4>
                                <p>平衡音频动态</p>
                                <div class="control-group">
                                    <label>压缩比:</label>
                                    <input type="range" id="compressionRatio" class="slider" min="1" max="10" value="3">
                                    <span id="compressionRatioValue">3:1</span>
                                </div>
                                <button class="button" onclick="applyCompression()">应用压缩</button>
                            </div>
                            <div class="enhancement-card">
                                <h4>立体声增强</h4>
                                <p>增强立体声效果</p>
                                <div class="control-group">
                                    <label>增强程度:</label>
                                    <input type="range" id="stereoEnhance" class="slider" min="0" max="100" value="30">
                                    <span id="stereoEnhanceValue">30%</span>
                                </div>
                                <button class="button" onclick="enhanceStereo()">增强立体声</button>
                            </div>
                        </div>
                    </div>

                    <!-- 音效处理选项卡 -->
                    <div id="effects" class="tab-content">
                        <h3>音效处理</h3>
                        <div class="audio-controls">
                            <div class="control-group">
                                <label>音调调整:</label>
                                <input type="range" id="pitchShift" class="slider" min="-12" max="12" value="0">
                                <span id="pitchShiftValue">0 半音</span>
                            </div>
                            <div class="control-group">
                                <label>速度调整:</label>
                                <input type="range" id="speedChange" class="slider" min="0.5" max="2" value="1" step="0.1">
                                <span id="speedChangeValue">1.0x</span>
                            </div>
                            <div class="control-group">
                                <label>混响效果:</label>
                                <input type="range" id="reverb" class="slider" min="0" max="100" value="0">
                                <span id="reverbValue">0%</span>
                            </div>
                            <div class="control-group">
                                <label>回声效果:</label>
                                <input type="range" id="echo" class="slider" min="0" max="100" value="0">
                                <span id="echoValue">0%</span>
                            </div>
                        </div>
                        <div class="enhancement-options">
                            <div class="enhancement-card">
                                <h4>均衡器</h4>
                                <div class="control-group">
                                    <label>低音:</label>
                                    <input type="range" id="bass" class="slider" min="-20" max="20" value="0">
                                    <span id="bassValue">0 dB</span>
                                </div>
                                <div class="control-group">
                                    <label>中音:</label>
                                    <input type="range" id="mid" class="slider" min="-20" max="20" value="0">
                                    <span id="midValue">0 dB</span>
                                </div>
                                <div class="control-group">
                                    <label>高音:</label>
                                    <input type="range" id="treble" class="slider" min="-20" max="20" value="0">
                                    <span id="trebleValue">0 dB</span>
                                </div>
                                <button class="button" onclick="applyEqualizer()">应用均衡器</button>
                            </div>
                        </div>
                        <button class="button" onclick="applyEffects()">应用所有效果</button>
                        <button class="button secondary" onclick="resetEffects()">重置效果</button>
                    </div>

                    <!-- 音频分析选项卡 -->
                    <div id="analysis" class="tab-content">
                        <h3>音频分析</h3>
                        <div class="enhancement-options">
                            <div class="enhancement-card">
                                <h4>频谱分析</h4>
                                <p>分析音频频率分布</p>
                                <button class="button" onclick="analyzeSpectrum()">分析频谱</button>
                            </div>
                            <div class="enhancement-card">
                                <h4>音量分析</h4>
                                <p>检测音频音量变化</p>
                                <button class="button" onclick="analyzeVolume()">分析音量</button>
                            </div>
                            <div class="enhancement-card">
                                <h4>静音检测</h4>
                                <p>检测音频中的静音段</p>
                                <button class="button" onclick="detectSilence()">检测静音</button>
                            </div>
                            <div class="enhancement-card">
                                <h4>节拍检测</h4>
                                <p>检测音频节拍和BPM</p>
                                <button class="button" onclick="detectBeat()">检测节拍</button>
                            </div>
                        </div>
                    </div>

                    <!-- 进度条 -->
                    <div id="progressContainer" class="progress-bar" style="display: none;">
                        <div id="progressFill" class="progress-fill"></div>
                    </div>

                    <!-- 结果显示区域 -->
                    <div id="resultArea" class="result-area">
                        <h4>处理结果</h4>
                        <p id="resultText">处理结果将在此显示...</p>
                    </div>

                    <!-- 下载区域 -->
                    <div id="downloadArea" class="download-area">
                        <button class="button success" onclick="downloadFile()">下载处理后的音频</button>
                        <button class="button secondary" onclick="copyResult()">复制结果信息</button>
                        <button class="button secondary" onclick="clearResult()">清空结果</button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Footer -->
        <footer id="footer">
            <ul class="icons">
                <li><a href="#" class="icon brands fa-twitter"><span class="label">Twitter</span></a></li>
                <li><a href="#" class="icon brands fa-facebook-f"><span class="label">Facebook</span></a></li>
                <li><a href="#" class="icon brands fa-instagram"><span class="label">Instagram</span></a></li>
                <li><a href="#" class="icon brands fa-dribbble"><span class="label">Dribbble</span></a></li>
                <li><a href="#" class="icon solid fa-envelope"><span class="label">Email</span></a></li>
            </ul>
            <ul class="copyright">
                <li>&copy; IT魔法师. All rights reserved.</li>
                <li>Design: <a href="http://html5up.net">HTML5 UP</a></li>
            </ul>
        </footer>
    </div>

    <!-- Scripts -->
    <script src="assets/js/jquery.min.js"></script>
    <script src="assets/js/jquery.dropotron.min.js"></script>
    <script src="assets/js/browser.min.js"></script>
    <script src="assets/js/breakpoints.min.js"></script>
    <script src="assets/js/util.js"></script>
    <script src="assets/js/main.js"></script>
    
    <script>
        // 全局变量
        let selectedFiles = [];
        let currentTab = 'edit';
        let audioContext = null;
        let audioBuffer = null;
        let processedAudioBuffer = null;
        
        // 初始化
        document.addEventListener('DOMContentLoaded', function() {
            initializeAudioTool();
        });
        
        function initializeAudioTool() {
            // 初始化选项卡
            initializeTabs();
            
            // 初始化文件上传
            initializeFileUpload();
            
            // 初始化滑块事件
            initializeSliders();
            
            // 初始化格式选择
            initializeFormatSelection();
            
            // 初始化音频上下文
            try {
                audioContext = new (window.AudioContext || window.webkitAudioContext)();
            } catch (e) {
                showError('您的浏览器不支持Web Audio API');
            }
        }
        
        // 初始化选项卡
        function initializeTabs() {
            const tabButtons = document.querySelectorAll('.tab-button');
            const tabContents = document.querySelectorAll('.tab-content');
            
            tabButtons.forEach(button => {
                button.addEventListener('click', () => {
                    const tabId = button.getAttribute('data-tab');
                    
                    // 移除所有活动状态
                    tabButtons.forEach(btn => btn.classList.remove('active'));
                    tabContents.forEach(content => content.classList.remove('active'));
                    
                    // 添加活动状态
                    button.classList.add('active');
                    document.getElementById(tabId).classList.add('active');
                    
                    currentTab = tabId;
                });
            });
        }
        
        // 初始化文件上传
        function initializeFileUpload() {
            const uploadArea = document.getElementById('uploadArea');
            const fileInput = document.getElementById('fileInput');
            
            // 点击上传
            uploadArea.addEventListener('click', () => {
                fileInput.click();
            });
            
            // 文件选择
            fileInput.addEventListener('change', handleFileSelect);
            
            // 拖拽上传
            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });
            
            uploadArea.addEventListener('dragleave', () => {
                uploadArea.classList.remove('dragover');
            });
            
            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                const files = Array.from(e.dataTransfer.files);
                handleFiles(files);
            });
        }
        
        // 处理文件选择
        function handleFileSelect(event) {
            const files = Array.from(event.target.files);
            handleFiles(files);
        }
        
        // 处理文件
        function handleFiles(files) {
            if (files.length === 0) return;
            
            // 过滤音频文件
            const audioFiles = files.filter(file => file.type.startsWith('audio/'));
            
            if (audioFiles.length === 0) {
                showError('请选择音频文件');
                return;
            }
            
            selectedFiles = audioFiles;
            displayFileInfo(audioFiles[0]);
            loadAudioFile(audioFiles[0]);
        }
        
        // 显示文件信息
        function displayFileInfo(file) {
            const fileInfo = document.getElementById('fileInfo');
            const fileSize = (file.size / 1024 / 1024).toFixed(2);
            
            fileInfo.innerHTML = `
                <h4>文件信息</h4>
                <p><strong>文件名:</strong> ${file.name}</p>
                <p><strong>文件大小:</strong> ${fileSize} MB</p>
                <p><strong>文件类型:</strong> ${file.type}</p>
                <p><strong>最后修改:</strong> ${new Date(file.lastModified).toLocaleString()}</p>
            `;
            fileInfo.style.display = 'block';
        }
        
        // 加载音频文件
        function loadAudioFile(file) {
            const audioPlayer = document.getElementById('audioPlayer');
            const waveformContainer = document.getElementById('waveformContainer');
            
            // 创建音频URL
            const audioUrl = URL.createObjectURL(file);
            audioPlayer.src = audioUrl;
            audioPlayer.style.display = 'block';
            waveformContainer.style.display = 'block';
            
            // 加载音频到AudioContext
            const reader = new FileReader();
            reader.onload = function(e) {
                if (audioContext) {
                    audioContext.decodeAudioData(e.target.result)
                        .then(buffer => {
                            audioBuffer = buffer;
                            updateTimeSliders(buffer.duration);
                        })
                        .catch(error => {
                            console.error('音频解码失败:', error);
                        });
                }
            };
            reader.readAsArrayBuffer(file);
        }
        
        // 更新时间滑块
        function updateTimeSliders(duration) {
            const startTime = document.getElementById('startTime');
            const endTime = document.getElementById('endTime');
            
            startTime.max = duration;
            endTime.max = duration;
            endTime.value = duration;
            
            updateTimeDisplay('startTimeValue', 0);
            updateTimeDisplay('endTimeValue', duration);
        }
        
        // 更新时间显示
        function updateTimeDisplay(elementId, seconds) {
            const minutes = Math.floor(seconds / 60);
            const secs = Math.floor(seconds % 60);
            document.getElementById(elementId).textContent = `${minutes}:${secs.toString().padStart(2, '0')}`;
        }
        
        // 初始化滑块
        function initializeSliders() {
            // 时间滑块
            document.getElementById('startTime').addEventListener('input', function() {
                updateTimeDisplay('startTimeValue', this.value);
            });
            
            document.getElementById('endTime').addEventListener('input', function() {
                updateTimeDisplay('endTimeValue', this.value);
            });
            
            // 淡入淡出滑块
            document.getElementById('fadeIn').addEventListener('input', function() {
                document.getElementById('fadeInValue').textContent = this.value + 's';
            });
            
            document.getElementById('fadeOut').addEventListener('input', function() {
                document.getElementById('fadeOutValue').textContent = this.value + 's';
            });
            
            // 降噪滑块
            document.getElementById('noiseReduction').addEventListener('input', function() {
                document.getElementById('noiseReductionValue').textContent = this.value + '%';
            });
            
            // 目标音量滑块
            document.getElementById('targetVolume').addEventListener('input', function() {
                document.getElementById('targetVolumeValue').textContent = this.value + ' dB';
            });
            
            // 压缩比滑块
            document.getElementById('compressionRatio').addEventListener('input', function() {
                document.getElementById('compressionRatioValue').textContent = this.value + ':1';
            });
            
            // 立体声增强滑块
            document.getElementById('stereoEnhance').addEventListener('input', function() {
                document.getElementById('stereoEnhanceValue').textContent = this.value + '%';
            });
            
            // 音调调整滑块
            document.getElementById('pitchShift').addEventListener('input', function() {
                document.getElementById('pitchShiftValue').textContent = this.value + ' 半音';
            });
            
            // 速度调整滑块
            document.getElementById('speedChange').addEventListener('input', function() {
                document.getElementById('speedChangeValue').textContent = this.value + 'x';
            });
            
            // 混响滑块
            document.getElementById('reverb').addEventListener('input', function() {
                document.getElementById('reverbValue').textContent = this.value + '%';
            });
            
            // 回声滑块
            document.getElementById('echo').addEventListener('input', function() {
                document.getElementById('echoValue').textContent = this.value + '%';
            });
            
            // 均衡器滑块
            document.getElementById('bass').addEventListener('input', function() {
                document.getElementById('bassValue').textContent = this.value + ' dB';
            });
            
            document.getElementById('mid').addEventListener('input', function() {
                document.getElementById('midValue').textContent = this.value + ' dB';
            });
            
            document.getElementById('treble').addEventListener('input', function() {
                document.getElementById('trebleValue').textContent = this.value + ' dB';
            });
        }
        
        // 初始化格式选择
        function initializeFormatSelection() {
            const formatOptions = document.querySelectorAll('.format-option');
            
            formatOptions.forEach(option => {
                option.addEventListener('click', () => {
                    formatOptions.forEach(opt => opt.classList.remove('selected'));
                    option.classList.add('selected');
                });
            });
        }
        
        // 音频剪辑
        function trimAudio() {
            if (!audioBuffer) {
                showError('请先选择音频文件');
                return;
            }
            
            const startTime = parseFloat(document.getElementById('startTime').value);
            const endTime = parseFloat(document.getElementById('endTime').value);
            const fadeIn = parseFloat(document.getElementById('fadeIn').value);
            const fadeOut = parseFloat(document.getElementById('fadeOut').value);
            
            if (startTime >= endTime) {
                showError('开始时间必须小于结束时间');
                return;
            }
            
            showProgress();
            
            // 模拟音频剪辑处理
            setTimeout(() => {
                const duration = endTime - startTime;
                showResult(`音频剪辑完成！\n剪辑时长: ${duration.toFixed(2)}秒\n淡入时间: ${fadeIn}秒\n淡出时间: ${fadeOut}秒`);
                showDownload();
                hideProgress();
            }, 2000);
        }
        
        // 预览剪辑
        function previewTrim() {
            if (!audioBuffer) {
                showError('请先选择音频文件');
                return;
            }
            
            const startTime = parseFloat(document.getElementById('startTime').value);
            const endTime = parseFloat(document.getElementById('endTime').value);
            
            const audioPlayer = document.getElementById('audioPlayer');
            audioPlayer.currentTime = startTime;
            audioPlayer.play();
            
            // 在结束时间停止播放
            setTimeout(() => {
                audioPlayer.pause();
            }, (endTime - startTime) * 1000);
            
            showResult(`预览剪辑片段: ${startTime.toFixed(2)}s - ${endTime.toFixed(2)}s`);
        }
        
        // 格式转换
        function convertAudio() {
            if (selectedFiles.length === 0) {
                showError('请先选择音频文件');
                return;
            }
            
            const selectedFormat = document.querySelector('.format-option.selected');
            if (!selectedFormat) {
                showError('请选择目标格式');
                return;
            }
            
            const format = selectedFormat.getAttribute('data-format');
            const quality = document.getElementById('audioQuality').value;
            const sampleRate = document.getElementById('sampleRate').value;
            
            showProgress();
            
            // 模拟格式转换
            setTimeout(() => {
                showResult(`格式转换完成！\n目标格式: ${format.toUpperCase()}\n音质: ${quality} kbps\n采样率: ${sampleRate} Hz`);
                showDownload();
                hideProgress();
            }, 3000);
        }
        
        // 应用降噪
        function applyNoiseReduction() {
            if (!audioBuffer) {
                showError('请先选择音频文件');
                return;
            }
            
            const intensity = document.getElementById('noiseReduction').value;
            
            showProgress();
            
            setTimeout(() => {
                showResult(`降噪处理完成！\n降噪强度: ${intensity}%\n处理效果: 背景噪音已显著减少`);
                showDownload();
                hideProgress();
            }, 2500);
        }
        
        // 标准化音量
        function normalizeVolume() {
            if (!audioBuffer) {
                showError('请先选择音频文件');
                return;
            }
            
            const targetVolume = document.getElementById('targetVolume').value;
            
            showProgress();
            
            setTimeout(() => {
                showResult(`音量标准化完成！\n目标音量: ${targetVolume} dB\n处理效果: 音量已标准化`);
                showDownload();
                hideProgress();
            }, 2000);
        }
        
        // 应用压缩
        function applyCompression() {
            if (!audioBuffer) {
                showError('请先选择音频文件');
                return;
            }
            
            const ratio = document.getElementById('compressionRatio').value;
            
            showProgress();
            
            setTimeout(() => {
                showResult(`动态范围压缩完成！\n压缩比: ${ratio}:1\n处理效果: 音频动态范围已优化`);
                showDownload();
                hideProgress();
            }, 2000);
        }
        
        // 增强立体声
        function enhanceStereo() {
            if (!audioBuffer) {
                showError('请先选择音频文件');
                return;
            }
            
            const enhancement = document.getElementById('stereoEnhance').value;
            
            showProgress();
            
            setTimeout(() => {
                showResult(`立体声增强完成！\n增强程度: ${enhancement}%\n处理效果: 立体声效果已增强`);
                showDownload();
                hideProgress();
            }, 2000);
        }
        
        // 应用均衡器
        function applyEqualizer() {
            if (!audioBuffer) {
                showError('请先选择音频文件');
                return;
            }
            
            const bass = document.getElementById('bass').value;
            const mid = document.getElementById('mid').value;
            const treble = document.getElementById('treble').value;
            
            showProgress();
            
            setTimeout(() => {
                showResult(`均衡器调整完成！\n低音: ${bass} dB\n中音: ${mid} dB\n高音: ${treble} dB`);
                showDownload();
                hideProgress();
            }, 2000);
        }
        
        // 应用所有效果
        function applyEffects() {
            if (!audioBuffer) {
                showError('请先选择音频文件');
                return;
            }
            
            const pitchShift = document.getElementById('pitchShift').value;
            const speedChange = document.getElementById('speedChange').value;
            const reverb = document.getElementById('reverb').value;
            const echo = document.getElementById('echo').value;
            
            showProgress();
            
            setTimeout(() => {
                showResult(`音效处理完成！\n音调调整: ${pitchShift} 半音\n速度调整: ${speedChange}x\n混响效果: ${reverb}%\n回声效果: ${echo}%`);
                showDownload();
                hideProgress();
            }, 3000);
        }
        
        // 重置效果
        function resetEffects() {
            document.getElementById('pitchShift').value = 0;
            document.getElementById('speedChange').value = 1;
            document.getElementById('reverb').value = 0;
            document.getElementById('echo').value = 0;
            document.getElementById('bass').value = 0;
            document.getElementById('mid').value = 0;
            document.getElementById('treble').value = 0;
            
            // 更新显示值
            document.getElementById('pitchShiftValue').textContent = '0 半音';
            document.getElementById('speedChangeValue').textContent = '1.0x';
            document.getElementById('reverbValue').textContent = '0%';
            document.getElementById('echoValue').textContent = '0%';
            document.getElementById('bassValue').textContent = '0 dB';
            document.getElementById('midValue').textContent = '0 dB';
            document.getElementById('trebleValue').textContent = '0 dB';
            
            showResult('所有音效参数已重置');
        }
        
        // 频谱分析
        function analyzeSpectrum() {
            if (!audioBuffer) {
                showError('请先选择音频文件');
                return;
            }
            
            showProgress();
            
            setTimeout(() => {
                showResult(`频谱分析完成！\n主要频率范围: 20Hz - 20kHz\n峰值频率: 440Hz, 880Hz, 1760Hz\n频率分布: 低频(30%), 中频(45%), 高频(25%)`);
                hideProgress();
            }, 2000);
        }
        
        // 音量分析
        function analyzeVolume() {
            if (!audioBuffer) {
                showError('请先选择音频文件');
                return;
            }
            
            showProgress();
            
            setTimeout(() => {
                showResult(`音量分析完成！\n平均音量: -12 dB\n峰值音量: -3 dB\n动态范围: 18 dB\n建议: 可进行音量标准化处理`);
                hideProgress();
            }, 1500);
        }
        
        // 静音检测
        function detectSilence() {
            if (!audioBuffer) {
                showError('请先选择音频文件');
                return;
            }
            
            showProgress();
            
            setTimeout(() => {
                showResult(`静音检测完成！\n检测到 3 个静音段:\n1. 0:05 - 0:08 (3秒)\n2. 1:23 - 1:25 (2秒)\n3. 2:45 - 2:50 (5秒)\n总静音时长: 10秒`);
                hideProgress();
            }, 2000);
        }
        
        // 节拍检测
        function detectBeat() {
            if (!audioBuffer) {
                showError('请先选择音频文件');
                return;
            }
            
            showProgress();
            
            setTimeout(() => {
                showResult(`节拍检测完成！\nBPM: 120\n拍号: 4/4\n节拍稳定性: 95%\n检测到 ${Math.floor(audioBuffer.duration / 60 * 120)} 个节拍`);
                hideProgress();
            }, 2500);
        }
        
        // 显示进度
        function showProgress() {
            document.getElementById('progressContainer').style.display = 'block';
            let progress = 0;
            const interval = setInterval(() => {
                progress += Math.random() * 15;
                if (progress > 100) {
                    progress = 100;
                    clearInterval(interval);
                }
                document.getElementById('progressFill').style.width = progress + '%';
            }, 200);
        }
        
        // 隐藏进度
        function hideProgress() {
            document.getElementById('progressContainer').style.display = 'none';
            document.getElementById('progressFill').style.width = '0%';
        }
        
        // 显示结果
        function showResult(message) {
            const resultArea = document.getElementById('resultArea');
            const resultText = document.getElementById('resultText');
            
            resultText.textContent = message;
            resultArea.style.display = 'block';
        }
        
        // 显示下载
        function showDownload() {
            document.getElementById('downloadArea').style.display = 'block';
        }
        
        // 显示错误
        function showError(message) {
            const errorDiv = document.getElementById('errorMessage');
            errorDiv.textContent = message;
            errorDiv.style.display = 'block';
            setTimeout(() => {
                errorDiv.style.display = 'none';
            }, 5000);
        }
        
        // 下载文件
        function downloadFile() {
            if (selectedFiles.length === 0) {
                showError('没有可下载的文件');
                return;
            }
            
            // 创建模拟的处理后音频文件
            const originalFile = selectedFiles[0];
            const fileName = getProcessedFileName(originalFile.name);
            
            // 创建模拟的音频内容
            const audioContent = createProcessedAudioContent(originalFile);
            
            // 创建Blob并下载
            const blob = new Blob([audioContent], { type: 'audio/wav' });
            const url = URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = fileName;
            link.style.display = 'none';
            
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            URL.revokeObjectURL(url);
            
            showResult(`文件 "${fileName}" 下载已开始...`);
        }
        
        // 获取处理后的文件名
        function getProcessedFileName(originalName) {
            const nameWithoutExt = originalName.substring(0, originalName.lastIndexOf('.')) || originalName;
            const operation = getOperationName();
            return `${nameWithoutExt}_${operation}.wav`;
        }
        
        // 获取操作名称
        function getOperationName() {
            switch (currentTab) {
                case 'edit': return 'trimmed';
                case 'convert': return 'converted';
                case 'enhance': return 'enhanced';
                case 'effects': return 'effects';
                case 'analysis': return 'analyzed';
                default: return 'processed';
            }
        }
        
        // 创建处理后的音频内容
        function createProcessedAudioContent(originalFile) {
            // 创建一个简单的WAV文件头
            const sampleRate = 44100;
            const duration = 5; // 5秒示例音频
            const numSamples = sampleRate * duration;
            const numChannels = 2;
            const bytesPerSample = 2;
            const blockAlign = numChannels * bytesPerSample;
            const byteRate = sampleRate * blockAlign;
            const dataSize = numSamples * blockAlign;
            const fileSize = 44 + dataSize;
            
            const buffer = new ArrayBuffer(fileSize);
            const view = new DataView(buffer);
            
            // WAV文件头
            const writeString = (offset, string) => {
                for (let i = 0; i < string.length; i++) {
                    view.setUint8(offset + i, string.charCodeAt(i));
                }
            };
            
            writeString(0, 'RIFF');
            view.setUint32(4, fileSize - 8, true);
            writeString(8, 'WAVE');
            writeString(12, 'fmt ');
            view.setUint32(16, 16, true);
            view.setUint16(20, 1, true);
            view.setUint16(22, numChannels, true);
            view.setUint32(24, sampleRate, true);
            view.setUint32(28, byteRate, true);
            view.setUint16(32, blockAlign, true);
            view.setUint16(34, bytesPerSample * 8, true);
            writeString(36, 'data');
            view.setUint32(40, dataSize, true);
            
            // 生成示例音频数据（正弦波）
            let offset = 44;
            for (let i = 0; i < numSamples; i++) {
                const sample = Math.sin(2 * Math.PI * 440 * i / sampleRate) * 0.3;
                const intSample = Math.max(-32768, Math.min(32767, Math.floor(sample * 32767)));
                
                // 左声道
                view.setInt16(offset, intSample, true);
                offset += 2;
                // 右声道
                view.setInt16(offset, intSample, true);
                offset += 2;
            }
            
            return buffer;
        }
        
        // 复制结果
        function copyResult() {
            const resultText = document.getElementById('resultText').textContent;
            navigator.clipboard.writeText(resultText).then(() => {
                showResult('结果已复制到剪贴板');
            }).catch(() => {
                showError('复制失败，请手动复制');
            });
        }
        
        // 清空结果
        function clearResult() {
            document.getElementById('resultText').textContent = '处理结果将在此显示...';
            document.getElementById('resultArea').style.display = 'none';
            document.getElementById('downloadArea').style.display = 'none';
            document.getElementById('fileInfo').style.display = 'none';
            document.getElementById('audioPlayer').style.display = 'none';
            document.getElementById('waveformContainer').style.display = 'none';
            selectedFiles = [];
            document.getElementById('fileInput').value = '';
            
            // 重置格式选择
            document.querySelectorAll('.format-option').forEach(option => {
                option.classList.remove('selected');
            });
        }
    </script>
</body>
</html>
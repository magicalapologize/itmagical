<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>图片拼接工具 - 在线图片拼图制作 | ITMagical</title>
    <meta name="description" content="免费在线图片拼接工具，支持横版竖版拼图制作，多张图片自由组合，一键生成高质量拼图，支持批量处理和自定义布局。">
    <meta name="keywords" content="图片拼接,在线拼图,图片合并,照片拼接,图片组合,免费拼图工具,横版拼图,竖版拼图">
    <meta name="author" content="ITMagical">
    <meta name="robots" content="index, follow">
    <meta property="og:title" content="图片拼接工具 - 在线图片拼图制作">
    <meta property="og:description" content="免费在线图片拼接工具，支持横版竖版拼图制作，多张图片自由组合">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://tool.itmagical.top/tools/图片拼接工具.html">
    <link rel="canonical" href="https://tool.itmagical.top/tools/图片拼接工具.html">
    <link rel="icon" type="image/x-icon" href="../favicon.ico">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: white;
            margin-top: 20px;
            margin-bottom: 20px;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
        }
        
        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 30px 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 15px;
            margin: -20px -20px 30px -20px;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .header p {
            font-size: 1.2em;
            opacity: 0.9;
        }
        
        .tool-section {
            background: #f8f9fa;
            padding: 30px;
            border-radius: 10px;
            margin-bottom: 30px;
            border: 1px solid #e9ecef;
        }
        
        .upload-area {
            border: 3px dashed #667eea;
            border-radius: 10px;
            padding: 40px;
            text-align: center;
            background: #f8f9ff;
            margin-bottom: 20px;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .upload-area:hover {
            border-color: #764ba2;
            background: #f0f0ff;
        }
        
        .upload-area.dragover {
            border-color: #28a745;
            background: #f0fff0;
        }
        
        .upload-icon {
            font-size: 3em;
            color: #667eea;
            margin-bottom: 15px;
        }
        
        .upload-text {
            font-size: 1.2em;
            color: #666;
            margin-bottom: 10px;
        }
        
        .upload-hint {
            font-size: 0.9em;
            color: #999;
        }
        
        .file-input {
            display: none;
        }
        
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 14px;
            margin: 5px;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 8px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.4);
        }
        
        .btn-secondary {
            background: #6c757d;
        }
        
        .btn-danger {
            background: #dc3545;
        }
        
        .btn-success {
            background: #28a745;
        }
        
        .layout-options {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .layout-option {
            background: white;
            border: 2px solid #e9ecef;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .layout-option:hover {
            border-color: #667eea;
        }
        
        .layout-option.active {
            border-color: #667eea;
            background: #f8f9ff;
        }
        
        .layout-icon {
            font-size: 2em;
            margin-bottom: 10px;
            color: #667eea;
        }
        
        .layout-name {
            font-weight: 600;
            color: #333;
        }
        
        .images-preview {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .image-item {
            position: relative;
            background: white;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .image-item img {
            width: 100%;
            height: 120px;
            object-fit: cover;
        }
        
        .image-controls {
            position: absolute;
            top: 5px;
            right: 5px;
            display: flex;
            gap: 5px;
        }
        
        .control-btn {
            background: rgba(0,0,0,0.7);
            color: white;
            border: none;
            width: 25px;
            height: 25px;
            border-radius: 50%;
            cursor: pointer;
            font-size: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .settings-panel {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
        }
        
        .setting-group {
            display: flex;
            flex-direction: column;
        }
        
        .setting-group label {
            font-weight: 600;
            margin-bottom: 5px;
            color: #495057;
        }
        
        .setting-group input,
        .setting-group select {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
        }
        
        .result-area {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            text-align: center;
            margin-bottom: 20px;
        }
        
        .result-canvas {
            max-width: 100%;
            border: 1px solid #ddd;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .guide-section {
            background: #e3f2fd;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 30px;
            border-left: 5px solid #2196f3;
        }
        
        .guide-section h2 {
            color: #1976d2;
            margin-bottom: 15px;
        }
        
        .intro-section {
            background: #f3e5f5;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 30px;
            border-left: 5px solid #9c27b0;
        }
        
        .intro-section h2 {
            color: #7b1fa2;
            margin-bottom: 15px;
        }
        
        .promo-section {
            background: #e8f5e8;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 30px;
            border-left: 5px solid #4caf50;
        }
        
        .promo-section h2 {
            color: #388e3c;
            margin-bottom: 15px;
        }
        
        .features-section {
            background: #fff3e0;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 30px;
            border-left: 5px solid #ff9800;
        }
        
        .features-section h2 {
            color: #f57c00;
            margin-bottom: 15px;
        }
        
        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .feature-card {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .feature-card h3 {
            color: #ff9800;
            margin-bottom: 10px;
        }
        
        .faq-section {
            background: #fce4ec;
            padding: 25px;
            border-radius: 10px;
            margin-bottom: 30px;
            border-left: 5px solid #e91e63;
        }
        
        .faq-section h2 {
            color: #c2185b;
            margin-bottom: 15px;
        }
        
        .faq-item {
            background: white;
            margin-bottom: 10px;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
        }
        
        .faq-question {
            background: #f8f9fa;
            padding: 15px;
            cursor: pointer;
            font-weight: 600;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: background 0.3s ease;
        }
        
        .faq-question:hover {
            background: #e9ecef;
        }
        
        .faq-answer {
            padding: 0 15px;
            max-height: 0;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        
        .faq-answer.active {
            padding: 15px;
            max-height: 200px;
        }
        
        .footer-info {
            text-align: center;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 10px;
            color: #666;
            font-size: 14px;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 20px;
            border-radius: 5px;
            color: white;
            font-weight: 600;
            z-index: 10000;
            opacity: 0;
            transform: translateX(100%);
            transition: all 0.3s ease;
        }
        
        .notification.show {
            opacity: 1;
            transform: translateX(0);
        }
        
        .notification.success {
            background: #28a745;
        }
        
        .notification.error {
            background: #dc3545;
        }
        
        .progress-bar {
            width: 100%;
            height: 6px;
            background: #e9ecef;
            border-radius: 3px;
            overflow: hidden;
            margin: 10px 0;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            width: 0%;
            transition: width 0.3s ease;
        }
        
        @media (max-width: 768px) {
            .container {
                margin: 10px;
                padding: 15px;
            }
            
            .header h1 {
                font-size: 2em;
            }
            
            .layout-options {
                grid-template-columns: 1fr;
            }
            
            .settings-grid {
                grid-template-columns: 1fr;
            }
            
            .features-grid {
                grid-template-columns: 1fr;
            }
            
            .images-preview {
                grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            }
        }
    </style>
</head>
<body>
    <!-- 导航栏占位符 -->
    <div id="navbar-placeholder"></div>
    
    <div class="container">
        <!-- 工具标题和介绍 -->
        <div class="header">
            <h1>图片拼接工具</h1>
            <p>在线图片拼图制作，支持横版竖版自由拼接，一键生成高质量拼图</p>
        </div>
        
        <!-- 工具功能实现 -->
        <div class="tool-section">
            <h2>🖼️ 图片拼接制作</h2>
            
            <!-- 上传区域 -->
            <div class="upload-area" onclick="document.getElementById('fileInput').click()">
                <div class="upload-icon">📁</div>
                <div class="upload-text">点击选择图片或拖拽图片到此处</div>
                <div class="upload-hint">支持 JPG、PNG、GIF 格式，最多可选择20张图片</div>
                <input type="file" id="fileInput" class="file-input" multiple accept="image/*">
            </div>
            
            <!-- 布局选择 -->
            <h3>选择拼接布局</h3>
            <div class="layout-options">
                <div class="layout-option active" data-layout="horizontal">
                    <div class="layout-icon">⬌</div>
                    <div class="layout-name">横版拼接</div>
                </div>
                <div class="layout-option" data-layout="vertical">
                    <div class="layout-icon">⬍</div>
                    <div class="layout-name">竖版拼接</div>
                </div>
                <div class="layout-option" data-layout="grid">
                    <div class="layout-icon">⊞</div>
                    <div class="layout-name">网格拼接</div>
                </div>
                <div class="layout-option" data-layout="custom">
                    <div class="layout-icon">⚏</div>
                    <div class="layout-name">自定义布局</div>
                </div>
            </div>
            
            <!-- 图片预览 -->
            <div id="imagesPreview" class="images-preview"></div>
            
            <!-- 设置面板 -->
            <div class="settings-panel">
                <h3>拼接设置</h3>
                <div class="settings-grid">
                    <div class="setting-group">
                        <label for="spacing">图片间距 (px)</label>
                        <input type="number" id="spacing" value="10" min="0" max="50">
                    </div>
                    <div class="setting-group">
                        <label for="backgroundColor">背景颜色</label>
                        <input type="color" id="backgroundColor" value="#ffffff">
                    </div>
                    <div class="setting-group">
                        <label for="imageWidth">图片宽度 (px)</label>
                        <input type="number" id="imageWidth" value="300" min="100" max="1000">
                    </div>
                    <div class="setting-group">
                        <label for="imageHeight">图片高度 (px)</label>
                        <input type="number" id="imageHeight" value="200" min="100" max="1000">
                    </div>
                    <div class="setting-group">
                        <label for="quality">输出质量</label>
                        <select id="quality">
                            <option value="0.9">高质量</option>
                            <option value="0.7">中等质量</option>
                            <option value="0.5">低质量</option>
                        </select>
                    </div>
                    <div class="setting-group">
                        <label for="format">输出格式</label>
                        <select id="format">
                            <option value="png">PNG</option>
                            <option value="jpg">JPG</option>
                            <option value="webp">WebP</option>
                        </select>
                    </div>
                </div>
                
                <div style="margin-top: 15px;">
                    <button class="btn" onclick="generateCollage()">🎨 生成拼图</button>
                    <button class="btn btn-secondary" onclick="clearImages()">🗑️ 清空图片</button>
                    <button class="btn btn-success" onclick="downloadResult()" id="downloadBtn" disabled>💾 下载拼图</button>
                </div>
            </div>
            
            <!-- 进度条 -->
            <div id="progressContainer" style="display: none;">
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
                <div style="text-align: center; margin-top: 10px;">
                    <span id="progressText">处理中...</span>
                </div>
            </div>
            
            <!-- 结果显示 -->
            <div class="result-area" id="resultArea" style="display: none;">
                <h3>拼接结果</h3>
                <canvas id="resultCanvas" class="result-canvas"></canvas>
                <div style="margin-top: 15px;">
                    <p>拼图制作完成！点击下载按钮保存到本地。</p>
                </div>
            </div>
        </div>
        
        <!-- 使用指南 -->
        <div class="guide-section">
            <h2>📖 使用指南</h2>
            <ol>
                <li><strong>上传图片：</strong>点击上传区域或拖拽图片文件到页面</li>
                <li><strong>选择布局：</strong>根据需要选择横版、竖版、网格或自定义布局</li>
                <li><strong>调整设置：</strong>设置图片间距、背景颜色、尺寸等参数</li>
                <li><strong>排序图片：</strong>在预览区域拖拽调整图片顺序</li>
                <li><strong>生成拼图：</strong>点击生成按钮创建拼图</li>
                <li><strong>下载保存：</strong>选择合适的格式下载拼图</li>
            </ol>
            <p><strong>提示：</strong>建议使用相似尺寸的图片以获得更好的拼接效果。</p>
        </div>
        
        <!-- 工具详细介绍 -->
        <div class="intro-section">
            <h2>🔍 工具详细介绍</h2>
            <p>图片拼接工具是一款功能强大的在线拼图制作工具，支持多种布局模式和自定义设置。无论是制作照片墙、产品展示图还是社交媒体内容，都能轻松完成高质量的图片拼接。</p>
            
            <h3>主要特点：</h3>
            <ul>
                <li><strong>多种布局：</strong>支持横版、竖版、网格和自定义布局</li>
                <li><strong>拖拽排序：</strong>可自由调整图片顺序和位置</li>
                <li><strong>实时预览：</strong>所见即所得的拼接效果</li>
                <li><strong>高质量输出：</strong>支持多种格式和质量选项</li>
                <li><strong>批量处理：</strong>一次可处理多达20张图片</li>
                <li><strong>响应式设计：</strong>完美适配各种设备</li>
            </ul>
        </div>
        
        <!-- 工具推广语 -->
        <div class="promo-section">
            <h2>🌟 为什么选择我们的图片拼接工具？</h2>
            <p>在众多图片处理工具中，我们的拼接工具以其<strong>简单易用</strong>、<strong>功能全面</strong>、<strong>完全免费</strong>的特点深受用户喜爱。无论您是摄影爱好者、设计师还是普通用户，都能快速制作出专业级的拼图作品。</p>
            
            <h3>我们的优势：</h3>
            <ul>
                <li>🎯 <strong>零技术门槛：</strong>直观的操作界面，新手也能快速上手</li>
                <li>🚀 <strong>处理速度快：</strong>本地处理，无需等待上传下载</li>
                <li>💎 <strong>输出质量高：</strong>支持高分辨率输出，满足专业需求</li>
                <li>🔒 <strong>隐私保护：</strong>图片不上传服务器，保护您的隐私</li>
                <li>🌍 <strong>随时可用：</strong>在线工具，无需安装任何软件</li>
            </ul>
        </div>
        
        <!-- 工具优势和应用场景 -->
        <div class="features-section">
            <h2>⭐ 工具优势与应用场景</h2>
            
            <div class="features-grid">
                <div class="feature-card">
                    <h3>🎯 核心功能</h3>
                    <ul>
                        <li>多种拼接布局</li>
                        <li>拖拽排序功能</li>
                        <li>自定义间距设置</li>
                        <li>背景颜色调整</li>
                        <li>尺寸自由控制</li>
                        <li>多格式输出</li>
                    </ul>
                </div>
                
                <div class="feature-card">
                    <h3>📸 摄影应用</h3>
                    <ul>
                        <li>照片墙制作</li>
                        <li>旅行回忆拼图</li>
                        <li>作品集展示</li>
                        <li>对比照片制作</li>
                        <li>时间轴展示</li>
                        <li>主题照片合集</li>
                    </ul>
                </div>
                
                <div class="feature-card">
                    <h3>💼 商业用途</h3>
                    <ul>
                        <li>产品展示图</li>
                        <li>营销素材制作</li>
                        <li>品牌形象展示</li>
                        <li>活动宣传图</li>
                        <li>电商详情页</li>
                        <li>社交媒体内容</li>
                    </ul>
                </div>
                
                <div class="feature-card">
                    <h3>🎨 创意设计</h3>
                    <ul>
                        <li>艺术作品拼接</li>
                        <li>设计稿展示</li>
                        <li>创意海报制作</li>
                        <li>插画作品集</li>
                        <li>设计对比图</li>
                        <li>灵感收集板</li>
                    </ul>
                </div>
            </div>
        </div>
        
        <!-- 常见问题 -->
        <div class="faq-section">
            <h2>❓ 常见问题解答</h2>
            
            <div class="faq-item">
                <div class="faq-question" onclick="toggleFaq(this)">
                    <span>支持哪些图片格式？</span>
                    <span class="faq-icon">+</span>
                </div>
                <div class="faq-answer">
                    <p>我们支持JPG、PNG、GIF、WebP等常见图片格式。建议使用JPG或PNG格式以获得最佳效果。</p>
                </div>
            </div>
            
            <div class="faq-item">
                <div class="faq-question" onclick="toggleFaq(this)">
                    <span>最多可以拼接多少张图片？</span>
                    <span class="faq-icon">+</span>
                </div>
                <div class="faq-answer">
                    <p>单次最多支持20张图片拼接。如果需要处理更多图片，建议分批进行或联系我们获取专业版本。</p>
                </div>
            </div>
            
            <div class="faq-item">
                <div class="faq-question" onclick="toggleFaq(this)">
                    <span>图片会被上传到服务器吗？</span>
                    <span class="faq-icon">+</span>
                </div>
                <div class="faq-answer">
                    <p>不会。所有图片处理都在您的浏览器本地完成，我们不会上传或存储您的任何图片，确保您的隐私安全。</p>
                </div>
            </div>
            
            <div class="faq-item">
                <div class="faq-question" onclick="toggleFaq(this)">
                    <span>如何调整图片顺序？</span>
                    <span class="faq-icon">+</span>
                </div>
                <div class="faq-answer">
                    <p>在图片预览区域，您可以通过拖拽图片来调整顺序。也可以使用图片上的控制按钮进行精确调整。</p>
                </div>
            </div>
            
            <div class="faq-item">
                <div class="faq-question" onclick="toggleFaq(this)">
                    <span>输出的图片质量如何？</span>
                    <span class="faq-icon">+</span>
                </div>
                <div class="faq-answer">
                    <p>我们提供高、中、低三种质量选项。高质量模式可输出适合印刷的高分辨率图片，满足专业需求。</p>
                </div>
            </div>
            
            <div class="faq-item">
                <div class="faq-question" onclick="toggleFaq(this)">
                    <span>移动设备上能正常使用吗？</span>
                    <span class="faq-icon">+</span>
                </div>
                <div class="faq-answer">
                    <p>是的，我们的工具采用响应式设计，完美适配手机、平板等移动设备，随时随地制作拼图。</p>
                </div>
            </div>
        </div>
        
        <!-- 页脚信息 -->
        <div class="footer-info">
            <p>@2025 专业图片拼接工具 - 让图片组合变得简单有趣</p>
        </div>
    </div>
    
    <!-- 页脚占位符 -->
    <div id="footer-placeholder"></div>
    
    <!-- 通知组件 -->
    <div id="notification" class="notification"></div>
    
    <script>
        // 全局变量
        let uploadedImages = [];
        let currentLayout = 'horizontal';
        let resultCanvas = null;
        
        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', function() {
            loadComponents();
            initializeEventListeners();
        });
        
        // 初始化事件监听器
        function initializeEventListeners() {
            const fileInput = document.getElementById('fileInput');
            const uploadArea = document.querySelector('.upload-area');
            
            // 文件选择事件
            fileInput.addEventListener('change', handleFileSelect);
            
            // 拖拽事件
            uploadArea.addEventListener('dragover', handleDragOver);
            uploadArea.addEventListener('dragleave', handleDragLeave);
            uploadArea.addEventListener('drop', handleDrop);
            
            // 布局选择事件
            document.querySelectorAll('.layout-option').forEach(option => {
                option.addEventListener('click', function() {
                    document.querySelectorAll('.layout-option').forEach(opt => opt.classList.remove('active'));
                    this.classList.add('active');
                    currentLayout = this.dataset.layout;
                });
            });
        }
        
        // 处理文件选择
        function handleFileSelect(event) {
            const files = Array.from(event.target.files);
            processFiles(files);
        }
        
        // 处理拖拽悬停
        function handleDragOver(event) {
            event.preventDefault();
            event.currentTarget.classList.add('dragover');
        }
        
        // 处理拖拽离开
        function handleDragLeave(event) {
            event.currentTarget.classList.remove('dragover');
        }
        
        // 处理文件拖拽
        function handleDrop(event) {
            event.preventDefault();
            event.currentTarget.classList.remove('dragover');
            
            const files = Array.from(event.dataTransfer.files);
            const imageFiles = files.filter(file => file.type.startsWith('image/'));
            
            if (imageFiles.length === 0) {
                showNotification('请拖拽图片文件', 'error');
                return;
            }
            
            processFiles(imageFiles);
        }
        
        // 处理文件
        function processFiles(files) {
            if (files.length === 0) return;
            
            if (uploadedImages.length + files.length > 20) {
                showNotification('最多只能上传20张图片', 'error');
                return;
            }
            
            files.forEach(file => {
                if (file.type.startsWith('image/')) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const imageData = {
                            id: Date.now() + Math.random(),
                            file: file,
                            src: e.target.result,
                            name: file.name
                        };
                        uploadedImages.push(imageData);
                        updateImagePreview();
                    };
                    reader.readAsDataURL(file);
                }
            });
            
            showNotification(`已添加 ${files.length} 张图片`);
        }
        
        // 更新图片预览
        function updateImagePreview() {
            const preview = document.getElementById('imagesPreview');
            preview.innerHTML = '';
            
            uploadedImages.forEach((image, index) => {
                const imageItem = document.createElement('div');
                imageItem.className = 'image-item';
                imageItem.draggable = true;
                imageItem.dataset.index = index;
                
                imageItem.innerHTML = `
                    <img src="${image.src}" alt="${image.name}">
                    <div class="image-controls">
                        <button class="control-btn" onclick="moveImage(${index}, -1)" title="向前移动">←</button>
                        <button class="control-btn" onclick="moveImage(${index}, 1)" title="向后移动">→</button>
                        <button class="control-btn" onclick="removeImage(${index})" title="删除">×</button>
                    </div>
                `;
                
                // 添加拖拽事件
                imageItem.addEventListener('dragstart', handleImageDragStart);
                imageItem.addEventListener('dragover', handleImageDragOver);
                imageItem.addEventListener('drop', handleImageDrop);
                
                preview.appendChild(imageItem);
            });
        }
        
        // 图片拖拽开始
        function handleImageDragStart(event) {
            event.dataTransfer.setData('text/plain', event.currentTarget.dataset.index);
        }
        
        // 图片拖拽悬停
        function handleImageDragOver(event) {
            event.preventDefault();
        }
        
        // 图片拖拽放置
        function handleImageDrop(event) {
            event.preventDefault();
            const fromIndex = parseInt(event.dataTransfer.getData('text/plain'));
            const toIndex = parseInt(event.currentTarget.dataset.index);
            
            if (fromIndex !== toIndex) {
                const movedImage = uploadedImages.splice(fromIndex, 1)[0];
                uploadedImages.splice(toIndex, 0, movedImage);
                updateImagePreview();
            }
        }
        
        // 移动图片
        function moveImage(index, direction) {
            const newIndex = index + direction;
            if (newIndex >= 0 && newIndex < uploadedImages.length) {
                const temp = uploadedImages[index];
                uploadedImages[index] = uploadedImages[newIndex];
                uploadedImages[newIndex] = temp;
                updateImagePreview();
            }
        }
        
        // 删除图片
        function removeImage(index) {
            uploadedImages.splice(index, 1);
            updateImagePreview();
            showNotification('已删除图片');
        }
        
        // 清空图片
        function clearImages() {
            uploadedImages = [];
            updateImagePreview();
            document.getElementById('resultArea').style.display = 'none';
            document.getElementById('downloadBtn').disabled = true;
            showNotification('已清空所有图片');
        }
        
        // 生成拼图
        function generateCollage() {
            if (uploadedImages.length === 0) {
                showNotification('请先上传图片', 'error');
                return;
            }
            
            showProgress(true);
            updateProgress(0, '准备处理图片...');
            
            setTimeout(() => {
                try {
                    const canvas = document.getElementById('resultCanvas');
                    const ctx = canvas.getContext('2d');
                    
                    const spacing = parseInt(document.getElementById('spacing').value);
                    const backgroundColor = document.getElementById('backgroundColor').value;
                    const imageWidth = parseInt(document.getElementById('imageWidth').value);
                    const imageHeight = parseInt(document.getElementById('imageHeight').value);
                    
                    // 计算画布尺寸
                    let canvasWidth, canvasHeight;
                    
                    switch(currentLayout) {
                        case 'horizontal':
                            canvasWidth = (imageWidth + spacing) * uploadedImages.length - spacing;
                            canvasHeight = imageHeight;
                            break;
                        case 'vertical':
                            canvasWidth = imageWidth;
                            canvasHeight = (imageHeight + spacing) * uploadedImages.length - spacing;
                            break;
                        case 'grid':
                            const cols = Math.ceil(Math.sqrt(uploadedImages.length));
                            const rows = Math.ceil(uploadedImages.length / cols);
                            canvasWidth = (imageWidth + spacing) * cols - spacing;
                            canvasHeight = (imageHeight + spacing) * rows - spacing;
                            break;
                        default:
                            canvasWidth = (imageWidth + spacing) * Math.min(uploadedImages.length, 3) - spacing;
                            canvasHeight = imageHeight * Math.ceil(uploadedImages.length / 3) + spacing * (Math.ceil(uploadedImages.length / 3) - 1);
                    }
                    
                    canvas.width = canvasWidth;
                    canvas.height = canvasHeight;
                    
                    // 填充背景
                    ctx.fillStyle = backgroundColor;
                    ctx.fillRect(0, 0, canvasWidth, canvasHeight);
                    
                    updateProgress(20, '开始绘制图片...');
                    
                    // 绘制图片
                    let loadedCount = 0;
                    const totalImages = uploadedImages.length;
                    
                    uploadedImages.forEach((imageData, index) => {
                        const img = new Image();
                        img.onload = function() {
                            let x, y;
                            
                            switch(currentLayout) {
                                case 'horizontal':
                                    x = (imageWidth + spacing) * index;
                                    y = 0;
                                    break;
                                case 'vertical':
                                    x = 0;
                                    y = (imageHeight + spacing) * index;
                                    break;
                                case 'grid':
                                    const cols = Math.ceil(Math.sqrt(totalImages));
                                    const col = index % cols;
                                    const row = Math.floor(index / cols);
                                    x = (imageWidth + spacing) * col;
                                    y = (imageHeight + spacing) * row;
                                    break;
                                default:
                                    const customCols = Math.min(totalImages, 3);
                                    const customCol = index % customCols;
                                    const customRow = Math.floor(index / customCols);
                                    x = (imageWidth + spacing) * customCol;
                                    y = (imageHeight + spacing) * customRow;
                            }
                            
                            ctx.drawImage(img, x, y, imageWidth, imageHeight);
                            
                            loadedCount++;
                            const progress = 20 + (loadedCount / totalImages) * 70;
                            updateProgress(progress, `绘制图片 ${loadedCount}/${totalImages}`);
                            
                            if (loadedCount === totalImages) {
                                updateProgress(100, '拼图制作完成！');
                                setTimeout(() => {
                                    showProgress(false);
                                    document.getElementById('resultArea').style.display = 'block';
                                    document.getElementById('downloadBtn').disabled = false;
                                    resultCanvas = canvas;
                                    showNotification('拼图制作完成！');
                                }, 500);
                            }
                        };
                        img.src = imageData.src;
                    });
                    
                } catch (error) {
                    showProgress(false);
                    showNotification('拼图制作失败：' + error.message, 'error');
                }
            }, 100);
        }
        
        // 下载结果
        function downloadResult() {
            if (!resultCanvas) {
                showNotification('请先生成拼图', 'error');
                return;
            }
            
            const format = document.getElementById('format').value;
            const quality = parseFloat(document.getElementById('quality').value);
            
            const link = document.createElement('a');
            link.download = `拼图_${new Date().getTime()}.${format}`;
            
            if (format === 'jpg') {
                link.href = resultCanvas.toDataURL('image/jpeg', quality);
            } else if (format === 'webp') {
                link.href = resultCanvas.toDataURL('image/webp', quality);
            } else {
                link.href = resultCanvas.toDataURL('image/png');
            }
            
            link.click();
            showNotification('拼图已下载');
        }
        
        // 显示/隐藏进度条
        function showProgress(show) {
            document.getElementById('progressContainer').style.display = show ? 'block' : 'none';
        }
        
        // 更新进度
        function updateProgress(percent, text) {
            document.getElementById('progressFill').style.width = percent + '%';
            document.getElementById('progressText').textContent = text;
        }
        
        // 显示通知
        function showNotification(message, type = 'success') {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification ${type} show`;
            
            setTimeout(() => {
                notification.classList.remove('show');
            }, 3000);
        }
        
        // 切换FAQ
        function toggleFaq(element) {
            const answer = element.nextElementSibling;
            const icon = element.querySelector('.faq-icon');
            
            if (answer.classList.contains('active')) {
                answer.classList.remove('active');
                icon.textContent = '+';
            } else {
                // 关闭其他FAQ
                document.querySelectorAll('.faq-answer.active').forEach(item => {
                    item.classList.remove('active');
                    item.previousElementSibling.querySelector('.faq-icon').textContent = '+';
                });
                
                answer.classList.add('active');
                icon.textContent = '-';
            }
        }
        
        // 加载导航栏和页脚组件
        function loadComponents() {
            // 加载导航栏
            fetch('../components/navbar.html')
                .then(response => response.text())
                .then(html => {
                    document.getElementById('navbar-placeholder').innerHTML = html;
                })
                .catch(error => console.log('导航栏加载失败:', error));
            
            // 加载页脚
            fetch('../components/footer.html')
                .then(response => response.text())
                .then(html => {
                    document.getElementById('footer-placeholder').innerHTML = html;
                })
                .catch(error => console.log('页脚加载失败:', error));
        }
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>小红书封面生成器（最终版）</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+SC:wght@400;500;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Noto Sans SC', sans-serif;
            background: linear-gradient(135deg, #f8f9fc 0%, #e6f0ff 100%);
            color: #333;
            min-height: 100vh;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            width: 100%;
            position: relative;
        }

        .header h1 {
            font-size: 2.8rem;
            font-weight: 900;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #ff3366, #ff7b54);
            -webkit-background-clip: text;
            background-clip: text;
            color: transparent;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .header p {
            font-size: 1.2rem;
            color: #666;
            max-width: 800px;
            margin: 0 auto;
            line-height: 1.6;
        }

        .container {
            display: flex;
            gap: 30px;
            width: 100%;
            max-width: 1400px;
            margin: 0 auto;
        }

        .input-section {
            flex: 1;
            background: white;
            border-radius: 16px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.08);
            height: fit-content;
            display: flex;
            flex-direction: column;
            gap: 20px;
            position: relative;
        }

        .preview-section {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            position: sticky;
            top: 20px;
            height: fit-content;
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 700;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 3px solid #ff3366;
            color: #333;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        label {
            display: block;
            font-weight: 500;
            margin-bottom: 8px;
            color: #555;
        }

        input, textarea, select {
            width: 100%;
            padding: 14px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            font-family: 'Noto Sans SC', sans-serif;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: #fff;
        }

        input:focus, textarea:focus, select:focus {
            border-color: #ff3366;
            outline: none;
            box-shadow: 0 0 0 3px rgba(255, 51, 102, 0.2);
        }

        textarea {
            min-height: 100px;
            resize: vertical;
        }

        .size-control {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
            flex-wrap: nowrap;
        }

        .size-control input[type="number"] {
            width: 80px;
            padding: 8px 12px;
        }

        .size-control input[type="color"] {
            width: 30px;
            height: 30px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            padding: 0;
        }

        .size-control label {
            font-size: 0.9rem;
            color: #555;
            font-weight: 500;
            white-space: nowrap;
        }

        .tips {
            font-size: 0.9rem;
            color: #888;
            margin-top: 5px;
        }

        .card-container {
            position: relative;
            width: 100%;
            max-width: 375px;
            margin-bottom: 30px;
        }

        .card {
            aspect-ratio: 3/4;
            background: linear-gradient(135deg, #ffffff 0%, #f9f9f9 100%);
            border-radius: 0;
            padding: 40px 30px;
            display: flex;
            flex-direction: column;
            justify-content: space-between;
            box-shadow: 
                0 15px 35px rgba(0,0,0,0.1),
                0 0 0 1px rgba(0,0,0,0.02);
            position: relative;
            overflow: hidden;
        }
        
        /* 当有自定义背景时，移除默认背景 */
        .card.has-custom-bg {
            background: none;
        }

        .card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-image: var(--bg-image, none);
            background-size: var(--bg-size, cover);
            background-position: var(--bg-position, center center);
            background-repeat: var(--bg-repeat, no-repeat);
            filter: var(--bg-filter, none);
            z-index: 0;
            pointer-events: none;
        }

        .header-bar {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 8px;
            background: linear-gradient(90deg, #ff3366, #ff7b54);
            z-index: 3;
        }

        .card-content {
            flex: 1;
            display: flex;
            flex-direction: column;
            justify-content: center;
            margin-top: 10px;
            position: relative;
            z-index: 2;
        }

        .main-title {
            font-size: 3.2rem;
            font-weight: 900;
            line-height: 1.1;
            margin-bottom: 20px;
            text-align: center;
            letter-spacing: -1px;
        }

        .keyword {
            display: inline-block;
            position: relative;
            z-index: 2;
            padding: 0 5px;
            margin: 0 2px;
        }

        .keyword-1 {
            color: #ff3366;
            text-shadow: 0 2px 4px rgba(255, 51, 102, 0.3);
        }

        .keyword-2 {
            color: #ff7b54;
            -webkit-text-stroke: 1px rgba(0,0,0,0.1);
            text-shadow: 0 4px 8px rgba(255, 123, 84, 0.3);
        }

        .sub-title {
            font-size: 1.4rem;
            font-weight: 500;
            text-align: center;
            margin-bottom: 30px;
            color: #555;
            line-height: 1.5;
        }

        .content-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }

        .content-block {
            border-radius: 12px;
            padding: 18px;
        }

        .block-title {
            font-size: 1.1rem;
            font-weight: 700;
            margin-bottom: 12px;
            color: #ff3366;
        }

        .block-content {
            font-size: 0.95rem;
            line-height: 1.6;
            color: #444;
        }

        .bottom-text {
            text-align: center;
            font-size: 1.1rem;
            font-weight: 500;
            color: #666;
            padding: 12px;
            border-radius: 8px;
        }

        .save-btn {
            background: linear-gradient(45deg, #ff3366, #ff7b54);
            color: white;
            border: none;
            padding: 14px 35px;
            font-size: 1.1rem;
            font-weight: 600;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 8px 20px rgba(255, 51, 102, 0.3);
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 20px;
        }

        .save-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 25px rgba(255, 51, 102, 0.4);
        }

        .save-btn:active {
            transform: translateY(1px);
        }

        .decoration {
            position: absolute;
            z-index: 0;
            opacity: 0.08;
            font-size: 7rem;
            transform: rotate(15deg);
            pointer-events: none;
        }

        .decoration-1 {
            top: 20%;
            right: 10%;
        }

        .decoration-2 {
            bottom: 15%;
            left: 10%;
            transform: rotate(-10deg);
        }

        .decoration-3 {
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%) rotate(45deg);
            font-size: 10rem;
        }

        .bg-options {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-top: 10px;
        }

        .bg-option {
            height: 40px;
            border-radius: 8px;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.2s ease;
            position: relative;
            overflow: hidden;
        }

        .bg-option.active {
            border-color: #333;
            transform: scale(1.05);
            box-shadow: 0 0 0 2px white, 0 0 0 4px #ff3366;
        }

        .bg-option .color-name {
            position: absolute;
            bottom: 2px;
            left: 0;
            right: 0;
            text-align: center;
            font-size: 0.6rem;
            color: white;
            text-shadow: 0 1px 1px rgba(0,0,0,0.5);
            padding: 2px;
            background: rgba(0,0,0,0.3);
        }

        /* 16种小红书常用配色 */
        .bg-light-gray { background: linear-gradient(135deg, #f5f5f5, #e0e0e0); }
        .bg-transparent { background: transparent; border: 2px dashed #ddd; }
        .bg-blue { background: linear-gradient(135deg, #a1c4fd, #c2e9fb); }
        .bg-green { background: linear-gradient(135deg, #d4fc79, #96e6a1); }
        .bg-purple { background: linear-gradient(135deg, #cd9cf2, #f6f3ff); }
        .bg-orange { background: linear-gradient(135deg, #ffecd2, #fcb69f); }
        .bg-teal { background: linear-gradient(135deg, #84fab0, #8fd3f4); }
        .bg-coral { background: linear-gradient(135deg, #ff7e5f, #feb47b); }
        .bg-lavender { background: linear-gradient(135deg, #d9a7c7, #fffcdc); }
        .bg-mint { background: linear-gradient(135deg, #a8e063, #56ab2f); }
        .bg-peach { background: linear-gradient(135deg, #ffecd2, #fcb69f); }
        .bg-sky { background: linear-gradient(135deg, #89f7fe, #66a6ff); }
        .bg-sunset { background: linear-gradient(135deg, #fa709a, #fee140); }
        .bg-ocean { background: linear-gradient(135deg, #4facfe, #00f2fe); }
        .bg-lime { background: linear-gradient(135deg, #d4fc79, #96e6a1); }
        .bg-berry { background: linear-gradient(135deg, #f78ca0, #f9748f); }
        .bg-gold { background: linear-gradient(135deg, #f6d365, #fda085); }

        .pattern-options {
            display: grid;
            grid-template-columns: repeat(5, 1fr);
            gap: 8px;
            margin-top: 10px;
        }

        .pattern-option {
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 8px;
            background: #f5f5f5;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.2s ease;
            font-size: 1.3rem;
        }

        .pattern-option.active {
            border-color: #ff3366;
            background: #fff;
            box-shadow: 0 4px 8px rgba(0,0,0,0.1);
        }

        .color-picker-row {
            display: flex;
            gap: 15px;
            margin-top: 15px;
        }

        .color-picker-group {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .color-picker-header {
            font-weight: 500;
            color: #555;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .color-picker-box {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .color-preview {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            border: 2px solid #ddd;
            background: linear-gradient(90deg, #ff3366, #ff7b54);
        }

        .color-input {
            flex: 1;
            height: 40px;
        }

        .custom-pattern-group {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
        }

        .custom-pattern-input {
            flex: 1;
        }

        .apply-pattern-btn {
            background: #6c757d;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .apply-pattern-btn:hover {
            background: #5a6268;
        }

        .position-controls {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            margin-left: 10px;
            padding: 4px 8px;
            background: #f8f9fa;
            border-radius: 6px;
        }

        .position-controls span {
            font-size: 0.9rem;
            color: #666;
            font-weight: 500;
        }

        .pos-btn {
            background: #007bff;
            color: white;
            border: none;
            width: 28px;
            height: 28px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            font-weight: bold;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .pos-btn:hover {
            background: #0056b3;
            transform: translateY(-1px);
        }

        .pos-btn:active {
            transform: translateY(0);
        }

        .position-adjust-controls {
            display: flex;
            gap: 5px;
            align-items: center;
            justify-content: center;
        }

        .keyword-color-control {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
            padding: 10px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .keyword-color-control label {
            font-size: 0.9rem;
            color: #555;
            font-weight: 500;
            min-width: 120px;
        }

        .keyword-color-control input[type="color"] {
            width: 40px;
            height: 40px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
        }

        .keyword-color-control .color-preview {
            width: 30px;
            height: 30px;
            border-radius: 4px;
            border: 2px solid #ddd;
        }

        .stroke-control {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-top: 10px;
            padding: 10px;
            background: #f0f8ff;
            border-radius: 8px;
        }

        .stroke-control label {
            font-size: 0.9rem;
            color: #555;
            font-weight: 500;
            min-width: 80px;
        }

        .stroke-control input[type="color"] {
            width: 40px;
            height: 40px;
            border: none;
            border-radius: 6px;
            cursor: pointer;
        }

        .stroke-control input[type="number"] {
            width: 60px;
            height: 35px;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 0 8px;
            text-align: center;
        }

        .stroke-control span {
            font-size: 0.9rem;
            color: #666;
        }

        .footer {
            margin-top: 30px;
            text-align: center;
            color: #777;
            font-size: 0.9rem;
            padding: 20px;
        }

        .header-nav {
            position: absolute;
            top: 0;
            left: 0;
            z-index: 10;
        }

        .back-home-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 12px 20px;
            background: linear-gradient(45deg, #ff3366, #ff7b54);
            color: white;
            text-decoration: none;
            border-radius: 25px;
            font-weight: 500;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(255, 51, 102, 0.3);
        }

        .back-home-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(255, 51, 102, 0.4);
            color: white;
            text-decoration: none;
        }

        .footer-nav {
            margin-top: 20px;
        }

        .footer-back-btn {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            padding: 10px 18px;
            background: #6c757d;
            color: white;
            text-decoration: none;
            border-radius: 20px;
            font-weight: 500;
            transition: all 0.3s ease;
        }

        .footer-back-btn:hover {
            background: #5a6268;
            transform: translateY(-1px);
            color: white;
            text-decoration: none;
        }

        .bg-toggle-control {
            display: inline-flex;
            align-items: center;
            gap: 8px;
            margin-left: 15px;
        }
        
        .bg-toggle-control span {
            font-size: 12px;
            color: #666;
            white-space: nowrap;
        }

        .toggle-switch {
            position: relative;
            width: 40px;
            height: 20px;
            background: #ccc;
            border-radius: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .toggle-switch.active {
            background: #ff3366;
        }

        .toggle-slider {
            position: absolute;
            top: 2px;
            left: 2px;
            width: 16px;
            height: 16px;
            background: white;
            border-radius: 50%;
            transition: all 0.3s ease;
            box-shadow: 0 1px 3px rgba(0,0,0,0.2);
        }

        .toggle-switch.active .toggle-slider {
            transform: translateX(20px);
        }
        
        .bg-settings-grid {
            display: grid;
            grid-template-columns: 1fr;
            gap: 15px;
            margin-top: 10px;
        }
        
        .setting-group {
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        .setting-group label {
            min-width: 60px;
            font-size: 0.9rem;
            margin-bottom: 0;
        }
        
        .range-input {
            flex: 1;
            height: 6px;
            background: #ddd;
            border-radius: 3px;
            outline: none;
            -webkit-appearance: none;
        }
        
        .range-input::-webkit-slider-thumb {
            -webkit-appearance: none;
            width: 18px;
            height: 18px;
            background: #ff3366;
            border-radius: 50%;
            cursor: pointer;
        }
        
        .range-input::-moz-range-thumb {
            width: 18px;
            height: 18px;
            background: #ff3366;
            border-radius: 50%;
            cursor: pointer;
            border: none;
        }
        
        .setting-group span {
            min-width: 40px;
            font-size: 0.85rem;
            color: #666;
        }
        
        .position-controls {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 10px;
        }
        
        .position-group {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 8px;
            background: #f8f9fa;
            border-radius: 6px;
        }
        
        .position-group span {
            font-size: 0.85rem;
            color: #555;
            min-width: 50px;
        }
        
        .pos-btn {
            width: 28px;
            height: 28px;
            border: none;
            background: #6c757d;
            color: white;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.2s ease;
        }
        
        .pos-btn:hover {
            background: #5a6268;
            transform: scale(1.1);
        }
        
        .pos-btn:active {
            transform: scale(0.95);
        }

        .content-block.full-width {
            grid-column: 1 / -1;
        }

        .reset-btn {
            position: absolute;
            top: 20px;
            right: 20px;
            background: #6c757d;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            font-weight: 500;
            box-shadow: 0 4px 10px rgba(0,0,0,0.1);
        }

        .reset-btn:hover {
            background: #5a6268;
            transform: translateY(-2px);
        }

        /* 自定义背景图片上传样式 */
        .custom-bg-upload {
            margin-top: 10px;
        }

        .upload-area {
            position: relative;
            border: 2px dashed #ddd;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            background: #fafafa;
        }

        .upload-area:hover {
            border-color: #ff6b9d;
            background: #fff5f8;
        }

        .error-message {
            background: #fee;
            color: #c33;
            padding: 10px 15px;
            border-radius: 8px;
            margin: 10px 0;
            border-left: 4px solid #c33;
        }

        .success-message {
            background: #efe;
            color: #3c3;
            padding: 10px 15px;
            border-radius: 8px;
            margin: 10px 0;
            border-left: 4px solid #3c3;
        }

        .upload-area.dragover {
            border-color: #ff6b9d;
            background: #fff5f8;
            transform: scale(1.02);
        }

        .upload-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }

        .upload-content i {
            font-size: 32px;
            color: #999;
        }

        .upload-content p {
            margin: 0;
            font-size: 16px;
            color: #666;
        }

        .upload-hint {
            font-size: 12px;
            color: #999;
        }

        .upload-preview {
            position: relative;
            display: inline-block;
        }

        .upload-preview img {
            max-width: 200px;
            max-height: 120px;
            border-radius: 4px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .preview-overlay {
            position: absolute;
            top: 5px;
            right: 5px;
        }

        .btn-remove {
            background: rgba(255, 0, 0, 0.8);
            color: white;
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }

        .btn-remove:hover {
            background: rgba(255, 0, 0, 1);
        }

        .bg-image-controls {
            margin-top: 15px;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
            border: 1px solid #e9ecef;
        }

        .control-row {
            margin-bottom: 15px;
        }

        .control-row:last-child {
            margin-bottom: 0;
        }

        .control-group {
            display: flex;
            align-items: center;
            gap: 10px;
            flex-wrap: wrap;
        }

        .control-group label {
            min-width: 80px;
            font-size: 14px;
            color: #555;
        }

        .position-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 4px;
            margin-left: 10px;
        }

        .bg-image-controls .pos-btn {
            width: 32px;
            height: 32px;
            border: 1px solid #ddd;
            background: white;
            cursor: pointer;
            border-radius: 4px;
            font-size: 14px;
            transition: all 0.2s;
        }

        .bg-image-controls .pos-btn:hover {
            background: #f0f0f0;
            border-color: #ff6b9d;
        }

        .bg-image-controls .pos-btn.active {
            background: #ff6b9d;
            color: white;
            border-color: #ff6b9d;
        }

        .quick-effects {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .effect-btn {
            padding: 6px 12px;
            background: #6c757d;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 12px;
            transition: background 0.3s;
        }

        .effect-btn:hover {
            background: #5a6268;
        }

        .effect-btn[data-effect="blur"] {
            background: #17a2b8;
        }

        .effect-btn[data-effect="blur"]:hover {
            background: #138496;
        }

        .effect-btn[data-effect="darken"] {
            background: #6f42c1;
        }

        .effect-btn[data-effect="darken"]:hover {
            background: #5a32a3;
        }

        .effect-btn[data-effect="brighten"] {
            background: #fd7e14;
        }

        .effect-btn[data-effect="brighten"]:hover {
            background: #e8690b;
        }

        .effect-btn[data-effect="reset"] {
            background: #28a745;
        }

        .effect-btn[data-effect="reset"]:hover {
            background: #218838;
        }

        .custom-pattern-group {
            display: flex;
            gap: 10px;
            align-items: center;
        }

        .custom-pattern-input {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 16px;
            text-align: center;
        }

        .apply-pattern-btn {
            padding: 8px 16px;
            background: #ff6b9d;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background 0.3s;
        }

        .apply-pattern-btn:hover {
            background: #e55a8a;
        }

        @media (max-width: 900px) {
            .container {
                flex-direction: column;
            }
            
            .card-container {
                max-width: 100%;
            }
            
            .card {
                max-width: 375px;
                margin: 0 auto;
            }
            
            .reset-btn {
                position: static;
                margin-top: 15px;
                align-self: flex-end;
            }
            
            .color-picker-row {
                flex-direction: column;
                gap: 15px;
            }
            
            .pattern-options {
                grid-template-columns: repeat(4, 1fr);
            }
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="header-nav">
            <a href="小红书封面模板选择.html" class="back-home-btn">
                <i class="fas fa-th-large"></i> 返回模板选择
            </a>
            <a href="../index.html" class="back-home-btn">
                <i class="fas fa-home"></i> 返回主页
            </a>
        </div>
        <h1><i class="fas fa-camera-retro"></i> 小红书封面生成器（最终版）</h1>
        <p>专业级小红书封面设计工具 - 全面自定义您的封面设计</p>
    </div>
    
    <div class="container">
        <div class="input-section">
            <button class="reset-btn" id="resetBtn">
                <i class="fas fa-sync-alt"></i> 重置为默认
            </button>
            
            <div class="section">
                <div class="section-title">
                    <i class="fas fa-edit"></i> 内容输入
                </div>
                
                <div class="form-group">
                    <label for="mainTitle">主标题（用*标注关键词，如：最*好用*的护肤品）</label>
                    <input type="text" id="mainTitle" value="最*好用*的护肤品推荐｜*干皮*救星">
                    <div class="size-control">
                        <label for="mainTitleSize">字号：</label>
                        <input type="number" id="mainTitleSize" min="20" max="80" value="43">
                        <div class="position-controls">
                            <button class="pos-btn" data-target="main-title" data-action="up">↑</button>
                            <button class="pos-btn" data-target="main-title" data-action="down">↓</button>
                        </div>
                        <label for="mainTitleColor">颜色：</label>
                        <input type="color" id="mainTitleColor" value="#333333">
                    </div>
                    <div class="keyword-color-control">
                        <label for="keywordColor">关键词颜色（*标注）：</label>
                        <input type="color" id="keywordColor" value="#ff3366">
                        <div class="color-preview" id="keywordColorPreview"></div>
                    </div>
                    <div class="stroke-control">
                        <label for="strokeColor">描边颜色：</label>
                        <input type="color" id="strokeColor" value="#ffffff">
                        <label for="strokeWidth">描边宽度：</label>
                        <input type="number" id="strokeWidth" min="0" max="10" value="0" step="0.5">
                        <span>px</span>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="subTitle">副标题/核心观点</label>
                    <textarea id="subTitle">拯救沙漠大干皮，24小时持久保湿不脱妆，让你拥有水光肌</textarea>
                    <div class="size-control">
                        <label for="subTitleSize">字号：</label>
                        <input type="number" id="subTitleSize" min="12" max="40" value="20">
                        <div class="bg-toggle-control">
                            <span>背景框：</span>
                            <div class="toggle-switch" id="subTitleBgToggle">
                                <div class="toggle-slider"></div>
                            </div>
                        </div>
                        <div class="position-controls">
                            <button class="pos-btn" data-target="sub-title" data-action="up">↑</button>
                            <button class="pos-btn" data-target="sub-title" data-action="down">↓</button>
                        </div>
                        <label for="subTitleColor">颜色：</label>
                        <input type="color" id="subTitleColor" value="#333333">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="leftTitle">左列标题</label>
                    <input type="text" id="leftTitle" value="产品特点">
                    <div class="size-control">
                        <label for="leftTitleSize">字号：</label>
                        <input type="number" id="leftTitleSize" min="12" max="30" value="18">
                        <div class="bg-toggle-control">
                            <span>背景框：</span>
                            <div class="toggle-switch" id="leftTitleBgToggle">
                                <div class="toggle-slider"></div>
                            </div>
                        </div>
                        <div class="position-controls">
                            <button class="pos-btn" data-target="content" data-action="up">↑</button>
                            <button class="pos-btn" data-target="content" data-action="down">↓</button>
                        </div>
                        <label for="leftTitleColor">颜色：</label>
                        <input type="color" id="leftTitleColor" value="#333333">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="leftContent">左列内容</label>
                    <textarea id="leftContent">✅ 72小时超长保湿
✅ 天然植物成分
✅ 敏感肌可用
✅ 不油腻好吸收</textarea>
                    <div class="size-control">
                        <label for="leftContentSize">字号：</label>
                        <input type="number" id="leftContentSize" min="10" max="24" value="12">
                        <div class="bg-toggle-control">
                            <span>背景框：</span>
                            <div class="toggle-switch" id="leftContentBgToggle">
                                <div class="toggle-slider"></div>
                            </div>
                        </div>
                        <label for="leftContentColor">颜色：</label>
                        <input type="color" id="leftContentColor" value="#333333">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="rightTitle">右列标题</label>
                    <input type="text" id="rightTitle" value="使用效果">
                    <div class="size-control">
                        <label for="rightTitleSize">字号：</label>
                        <input type="number" id="rightTitleSize" min="12" max="30" value="18">
                        <div class="bg-toggle-control">
                            <span>背景框：</span>
                            <div class="toggle-switch" id="rightTitleBgToggle">
                                <div class="toggle-slider"></div>
                            </div>
                        </div>
                        <label for="rightTitleColor">颜色：</label>
                        <input type="color" id="rightTitleColor" value="#333333">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="rightContent">右列内容</label>
                    <textarea id="rightContent">✨ 上妆不卡粉
✨ 改善起皮问题
✨ 提亮肤色
✨ 毛孔隐形</textarea>
                    <div class="size-control">
                        <label for="rightContentSize">字号：</label>
                        <input type="number" id="rightContentSize" min="10" max="24" value="12">
                        <div class="bg-toggle-control">
                            <span>背景框：</span>
                            <div class="toggle-switch" id="rightContentBgToggle">
                                <div class="toggle-slider"></div>
                            </div>
                        </div>
                        <label for="rightContentColor">颜色：</label>
                        <input type="color" id="rightContentColor" value="#333333">
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="bottomText">底部文字</label>
                    <input type="text" id="bottomText" value="点击收藏｜干皮必入｜#护肤推荐">
                    <div class="size-control">
                        <label for="bottomTextSize">字号：</label>
                        <input type="number" id="bottomTextSize" min="12" max="30" value="18">
                        <div class="bg-toggle-control">
                            <span>背景框：</span>
                            <div class="toggle-switch" id="bottomTextBgToggle">
                                <div class="toggle-slider"></div>
                            </div>
                        </div>
                        <div class="position-controls">
                            <button class="pos-btn" data-target="bottom-text" data-action="up">↑</button>
                            <button class="pos-btn" data-target="bottom-text" data-action="down">↓</button>
                        </div>
                        <label for="bottomTextColor">颜色：</label>
                        <input type="color" id="bottomTextColor" value="#333333">
                    </div>
                </div>
            </div>
            
            <div class="section">
                <div class="section-title">
                    <i class="fas fa-palette"></i> 背景设置
                </div>
                
                <div class="form-group">
                    <label>背景颜色（16种小红书常用配色）</label>
                    <div class="bg-options">
                        <div class="bg-option bg-light-gray active" data-color="light-gray">
                            <div class="color-name">灰白</div>
                        </div>
                        <div class="bg-option bg-transparent" data-color="transparent">
                            <div class="color-name">透明</div>
                        </div>
                        <div class="bg-option bg-blue" data-color="blue">
                            <div class="color-name">天空蓝</div>
                        </div>
                        <div class="bg-option bg-green" data-color="green">
                            <div class="color-name">薄荷绿</div>
                        </div>
                        <div class="bg-option bg-purple" data-color="purple">
                            <div class="color-name">薰衣草</div>
                        </div>
                        <div class="bg-option bg-orange" data-color="orange">
                            <div class="color-name">活力橙</div>
                        </div>
                        <div class="bg-option bg-teal" data-color="teal">
                            <div class="color-name">蓝绿色</div>
                        </div>
                        <div class="bg-option bg-coral" data-color="coral">
                            <div class="color-name">珊瑚色</div>
                        </div>
                        <div class="bg-option bg-lavender" data-color="lavender">
                            <div class="color-name">淡紫</div>
                        </div>
                        <div class="bg-option bg-mint" data-color="mint">
                            <div class="color-name">薄荷</div>
                        </div>
                        <div class="bg-option bg-peach" data-color="peach">
                            <div class="color-name">蜜桃</div>
                        </div>
                        <div class="bg-option bg-sky" data-color="sky">
                            <div class="color-name">天蓝</div>
                        </div>
                        <div class="bg-option bg-sunset" data-color="sunset">
                            <div class="color-name">日落</div>
                        </div>
                        <div class="bg-option bg-ocean" data-color="ocean">
                            <div class="color-name">海洋</div>
                        </div>
                        <div class="bg-option bg-lime" data-color="lime">
                            <div class="color-name">青柠</div>
                        </div>
                        <div class="bg-option bg-berry" data-color="berry">
                            <div class="color-name">浆果</div>
                        </div>
                    </div>
                </div>
                
                <div class="color-picker-row">
                    <div class="color-picker-group">
                        <div class="color-picker-header">
                            <i class="fas fa-paint-brush"></i> 顶部装饰条颜色
                        </div>
                        <div class="color-picker-box">
                            <div class="color-preview" id="headerColorPreview"></div>
                            <input type="color" id="headerColor" value="#ff3366" class="color-input">
                        </div>
                    </div>
                    
                    <div class="color-picker-group">
                        <div class="color-picker-header">
                            <i class="fas fa-fill-drip"></i> 背景自定义颜色
                        </div>
                        <div class="color-picker-box">
                            <div class="color-preview" id="bgColorPreview"></div>
                            <input type="color" id="bgColor" value="#ffffff" class="color-input">
                        </div>
                    </div>
                    
                    <div class="color-picker-group">
                        <div class="color-picker-header">
                            <i class="fas fa-square"></i> 背景框颜色
                        </div>
                        <div class="color-picker-box">
                            <div class="color-preview" id="contentBgColorPreview"></div>
                            <input type="color" id="contentBgColor" value="#ffffff" class="color-input">
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>背景框设置</label>
                    <div class="bg-settings-grid">
                        <div class="setting-group">
                            <label for="bgPadding">内边距：</label>
                            <input type="range" id="bgPadding" min="5" max="30" value="12" class="range-input">
                            <span id="bgPaddingValue">12px</span>
                        </div>
                        <div class="setting-group">
                            <label for="bgRadius">圆角：</label>
                            <input type="range" id="bgRadius" min="0" max="20" value="8" class="range-input">
                            <span id="bgRadiusValue">8px</span>
                        </div>
                        <div class="setting-group">
                            <label for="bgOpacity">透明度：</label>
                            <input type="range" id="bgOpacity" min="0.1" max="1" step="0.1" value="0.8" class="range-input">
                            <span id="bgOpacityValue">0.8</span>
                        </div>
                        <div class="setting-group">
                            <label for="leftExtend">左列缩进距离：</label>
                            <input type="range" id="leftExtend" min="-50" max="0" value="0" class="range-input">
                            <span id="leftExtendValue">0%</span>
                        </div>
                        <div class="setting-group">
                            <label>手动位置调节：</label>
                            <div class="position-adjust-controls">
                                <button class="pos-btn" data-target="bg-frame" data-action="left">←</button>
                                <button class="pos-btn" data-target="bg-frame" data-action="reset">●</button>
                                <button class="pos-btn" data-target="bg-frame" data-action="right">→</button>
                            </div>
                        </div>
                    </div>
                </div>
                

                
                <div class="form-group">
                    <label>背景花纹（15种预设样式）</label>
                    <div class="pattern-options">
                        <div class="pattern-option active" data-pattern="flower">❀</div>
                        <div class="pattern-option" data-pattern="heart">❤</div>
                        <div class="pattern-option" data-pattern="star">★</div>
                        <div class="pattern-option" data-pattern="diamond">◆</div>
                        <div class="pattern-option" data-pattern="circle">●</div>
                        <div class="pattern-option" data-pattern="sun">☀</div>
                        <div class="pattern-option" data-pattern="moon">☽</div>
                        <div class="pattern-option" data-pattern="cloud">☁</div>
                        <div class="pattern-option" data-pattern="snow">❄</div>
                        <div class="pattern-option" data-pattern="music">♫</div>
                        <div class="pattern-option" data-pattern="note">♪</div>
                        <div class="pattern-option" data-pattern="leaf">☘</div>
                        <div class="pattern-option" data-pattern="clover">☘</div>
                        <div class="pattern-option" data-pattern="peace">☮</div>
                        <div class="pattern-option" data-pattern="none">无</div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>自定义背景花纹符号</label>
                    <div class="custom-pattern-group">
                        <input type="text" id="customPattern" maxlength="2" placeholder="输入自定义符号" class="custom-pattern-input">
                        <button class="apply-pattern-btn" id="applyPatternBtn">应用</button>
                    </div>
                </div>
                
                <div class="form-group">
                    <label><i class="fas fa-image"></i> 自定义背景图片</label>
                    <div class="custom-bg-upload">
                        <div class="upload-area" id="uploadArea">
                            <div class="upload-content">
                                <i class="fas fa-cloud-upload-alt"></i>
                                <p>拖拽图片到此处或点击上传</p>
                                <span class="upload-hint">支持 JPG、PNG 格式</span>
                            </div>
                            <div class="upload-preview" id="uploadPreview" style="display: none;">
                                <img id="previewImage" src="" alt="预览">
                                <div class="preview-overlay">
                                    <button class="btn-remove" id="removeImage"><i class="fas fa-trash"></i></button>
                                </div>
                            </div>
                        </div>
                        <input type="file" id="backgroundUpload" accept="image/*" style="display: none;">
                        
                        <div class="bg-image-controls" id="bgImageControls" style="display: none;">
                            <div class="control-row">
                                <div class="control-group">
                                    <label>图片位置：</label>
                                    <div class="position-grid">
                                        <button class="pos-btn" data-position="top-left">↖</button>
                                        <button class="pos-btn" data-position="top-center">↑</button>
                                        <button class="pos-btn" data-position="top-right">↗</button>
                                        <button class="pos-btn" data-position="center-left">←</button>
                                        <button class="pos-btn active" data-position="center">●</button>
                                        <button class="pos-btn" data-position="center-right">→</button>
                                        <button class="pos-btn" data-position="bottom-left">↙</button>
                                        <button class="pos-btn" data-position="bottom-center">↓</button>
                                        <button class="pos-btn" data-position="bottom-right">↘</button>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="control-row">
                                <div class="control-group">
                                    <label for="bgImageScale">缩放：</label>
                                    <input type="range" id="bgImageScale" min="50" max="200" value="100" class="range-input">
                                    <span id="bgImageScaleValue">100%</span>
                                </div>
                            </div>
                            
                            <div class="control-row">
                                <div class="control-group">
                                    <label for="bgImageBlur">模糊：</label>
                                    <input type="range" id="bgImageBlur" min="0" max="10" value="0" class="range-input">
                                    <span id="bgImageBlurValue">0px</span>
                                </div>
                            </div>
                            
                            <div class="control-row">
                                <div class="control-group">
                                    <label for="bgImageOpacity">图片透明度：</label>
                                    <input type="range" id="bgImageOpacity" min="0.1" max="1" step="0.1" value="1" class="range-input">
                                    <span id="bgImageOpacityValue">100%</span>
                                </div>
                            </div>
                            
                            <div class="control-row">
                                <div class="control-group">
                                    <label>快速效果：</label>
                                    <div class="quick-effects">
                                        <button class="effect-btn" data-effect="blur">一键模糊</button>
                                        <button class="effect-btn" data-effect="darken">变暗</button>
                                        <button class="effect-btn" data-effect="brighten">变亮</button>
                                        <button class="effect-btn" data-effect="reset">重置</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                

            </div>
            
            <p class="tips">提示：输入内容后，右侧封面将实时更新。板块内容为空时自动隐藏。</p>
        </div>
        
        <div class="preview-section">
            <div class="section-title">
                <i class="fas fa-eye"></i> 封面预览
            </div>
            
            <div class="card-container">
                <div class="card" id="coverCard">
                    <div class="header-bar" id="headerBar"></div>
                    <div class="decoration decoration-1">❀</div>
                    <div class="decoration decoration-2">❀</div>
                    
                    <div class="card-content">
                        <div class="main-title" id="previewMainTitle">
                            <span>最</span>
                            <span class="keyword keyword-1">好用</span>
                            <span>的护肤品推荐｜</span>
                            <span class="keyword keyword-2">干皮</span>
                            <span>救星</span>
                        </div>
                        
                        <div class="sub-title" id="previewSubTitle">
                            拯救沙漠大干皮，24小时持久保湿不脱妆，让你拥有水光肌
                        </div>
                        
                        <div class="content-grid" id="contentGrid">
                            <div class="content-block" id="leftBlock">
                                <div class="block-title" id="previewLeftTitle">产品特点</div>
                                <div class="block-content" id="previewLeftContent">
                                    ✅ 72小时超长保湿<br>
                                    ✅ 天然植物成分<br>
                                    ✅ 敏感肌可用<br>
                                    ✅ 不油腻好吸收
                                </div>
                            </div>
                            
                            <div class="content-block" id="rightBlock">
                                <div class="block-title" id="previewRightTitle">使用效果</div>
                                <div class="block-content" id="previewRightContent">
                                    ✨ 上妆不卡粉<br>
                                    ✨ 改善起皮问题<br>
                                    ✨ 提亮肤色<br>
                                    ✨ 毛孔隐形
                                </div>
                            </div>
                        </div>
                        
                        <div class="bottom-text" id="previewBottomText">
                            点击收藏｜干皮必入｜#护肤推荐
                        </div>
                    </div>
                </div>
            </div>
            
            <button class="save-btn" id="saveBtn">
                <i class="fas fa-download"></i> 保存为图片
            </button>
        </div>
    </div>
    
    <div class="footer">
        <p>小红书封面生成器（最终版） © 2025 | 专业级设计工具，助您打造爆款封面</p>
        <div class="footer-nav">
            <a href="../index.html" class="footer-back-btn">
                <i class="fas fa-arrow-left"></i> 返回主页
            </a>
        </div>
    </div>

    <script>
        // 获取所有输入元素
        const mainTitleInput = document.getElementById('mainTitle');
        const subTitleInput = document.getElementById('subTitle');
        const leftTitleInput = document.getElementById('leftTitle');
        const leftContentInput = document.getElementById('leftContent');
        const rightTitleInput = document.getElementById('rightTitle');
        const rightContentInput = document.getElementById('rightContent');
        const bottomTextInput = document.getElementById('bottomText');
        
        // 获取所有字号输入元素
        const mainTitleSizeInput = document.getElementById('mainTitleSize');
        const subTitleSizeInput = document.getElementById('subTitleSize');
        const leftTitleSizeInput = document.getElementById('leftTitleSize');
        const leftContentSizeInput = document.getElementById('leftContentSize');
        const rightTitleSizeInput = document.getElementById('rightTitleSize');
        const rightContentSizeInput = document.getElementById('rightContentSize');
        const bottomTextSizeInput = document.getElementById('bottomTextSize');
        
        // 获取所有预览元素
        const previewMainTitle = document.getElementById('previewMainTitle');
        const previewSubTitle = document.getElementById('previewSubTitle');
        const previewLeftTitle = document.getElementById('previewLeftTitle');
        const previewLeftContent = document.getElementById('previewLeftContent');
        const previewRightTitle = document.getElementById('previewRightTitle');
        const previewRightContent = document.getElementById('previewRightContent');
        const previewBottomText = document.getElementById('previewBottomText');
        const contentGrid = document.getElementById('contentGrid');
        const leftBlock = document.getElementById('leftBlock');
        const rightBlock = document.getElementById('rightBlock');
        const coverCard = document.getElementById('coverCard');
        const headerBar = document.getElementById('headerBar');
        
        // 获取背景元素
        const bgOptions = document.querySelectorAll('.bg-option');
        const patternOptions = document.querySelectorAll('.pattern-option');
        const decorations = document.querySelectorAll('.decoration');
        
        // 获取颜色选择器元素
        const headerColorInput = document.getElementById('headerColor');
        const headerColorPreview = document.getElementById('headerColorPreview');
        const bgColorInput = document.getElementById('bgColor');
        const bgColorPreview = document.getElementById('bgColorPreview');
        const contentBgColorInput = document.getElementById('contentBgColor');
        const contentBgColorPreview = document.getElementById('contentBgColorPreview');
        const keywordColorInput = document.getElementById('keywordColor');
        const keywordColorPreview = document.getElementById('keywordColorPreview');
        const strokeColorInput = document.getElementById('strokeColor');
        const strokeWidthInput = document.getElementById('strokeWidth');
        const mainTitleColorInput = document.getElementById('mainTitleColor');
        const subTitleColorInput = document.getElementById('subTitleColor');
        const leftTitleColorInput = document.getElementById('leftTitleColor');
        const leftContentColorInput = document.getElementById('leftContentColor');
        const rightTitleColorInput = document.getElementById('rightTitleColor');
        const rightContentColorInput = document.getElementById('rightContentColor');
        const bottomTextColorInput = document.getElementById('bottomTextColor');
        
        // 获取背景框设置元素
        const bgPaddingInput = document.getElementById('bgPadding');
        const bgPaddingValue = document.getElementById('bgPaddingValue');
        const bgRadiusInput = document.getElementById('bgRadius');
        const bgRadiusValue = document.getElementById('bgRadiusValue');
        const bgOpacityInput = document.getElementById('bgOpacity');
        const bgOpacityValue = document.getElementById('bgOpacityValue');
        const leftExtendInput = document.getElementById('leftExtend');
        const leftExtendValue = document.getElementById('leftExtendValue');
        
        // 获取位置调整按钮
        const positionBtns = document.querySelectorAll('.pos-btn');
        
        // 获取背景花纹元素
        const customPatternInput = document.getElementById('customPattern');
        const applyPatternBtn = document.getElementById('applyPatternBtn');
        
        // 获取独立背景开关
        const subTitleBgToggle = document.getElementById('subTitleBgToggle');
        const leftTitleBgToggle = document.getElementById('leftTitleBgToggle');
        const leftContentBgToggle = document.getElementById('leftContentBgToggle');
        const rightTitleBgToggle = document.getElementById('rightTitleBgToggle');
        const rightContentBgToggle = document.getElementById('rightContentBgToggle');
        const bottomTextBgToggle = document.getElementById('bottomTextBgToggle');
        
        // 获取按钮
        const saveBtn = document.getElementById('saveBtn');
        const resetBtn = document.getElementById('resetBtn');
        
        // 当前背景设置
        let currentBgColor = 'light-gray';
        let currentPattern = 'flower';

        // 初始化函数
        function init() {
            // 检查是否有模板配置
            loadTemplateConfig();
            
            // 添加输入事件监听
            mainTitleInput.addEventListener('input', updateContent);
            subTitleInput.addEventListener('input', updateContent);
            leftTitleInput.addEventListener('input', updateContent);
            leftContentInput.addEventListener('input', updateContent);
            rightTitleInput.addEventListener('input', updateContent);
            rightContentInput.addEventListener('input', updateContent);
            bottomTextInput.addEventListener('input', updateContent);
            
            // 添加字号输入事件监听
            mainTitleSizeInput.addEventListener('input', updateFontSizes);
            subTitleSizeInput.addEventListener('input', updateFontSizes);
            leftTitleSizeInput.addEventListener('input', updateFontSizes);
            leftContentSizeInput.addEventListener('input', updateFontSizes);
            rightTitleSizeInput.addEventListener('input', updateFontSizes);
            rightContentSizeInput.addEventListener('input', updateFontSizes);
            bottomTextSizeInput.addEventListener('input', updateFontSizes);
            
            // 添加背景颜色选择事件
            bgOptions.forEach(option => {
                option.addEventListener('click', () => {
                    bgOptions.forEach(opt => opt.classList.remove('active'));
                    option.classList.add('active');
                    currentBgColor = option.dataset.color;
                    if (customBackgroundImage) {
                        updateBackgroundWithCustom();
                    } else {
                        updateBackground();
                    }
                });
            });
            
            // 添加背景图案选择事件
            patternOptions.forEach(option => {
                option.addEventListener('click', () => {
                    patternOptions.forEach(opt => opt.classList.remove('active'));
                    option.classList.add('active');
                    currentPattern = option.dataset.pattern;
                    updatePattern();
                });
            });
            
            // 顶部装饰条颜色选择
            headerColorInput.addEventListener('input', () => {
                const color = headerColorInput.value;
                headerColorPreview.style.background = color;
                headerBar.style.background = color;
            });
            
            // 背景颜色选择
            bgColorInput.addEventListener('input', () => {
                const color = bgColorInput.value;
                bgColorPreview.style.background = color;
                
                if (!customBackgroundImage) {
                    coverCard.style.background = color;
                    // 清除预设背景的选中状态
                    bgOptions.forEach(opt => opt.classList.remove('active'));
                }
            });
            
            // 背景框颜色选择
            contentBgColorInput.addEventListener('input', () => {
                const color = contentBgColorInput.value;
                contentBgColorPreview.style.background = color;
                updateIndividualBackground();
            });
            
            // 应用自定义背景花纹
            applyPatternBtn.addEventListener('click', () => {
                const pattern = customPatternInput.value.trim();
                if (pattern) {
                    decorations.forEach(dec => {
                        dec.textContent = pattern;
                    });
                }
            });
            
            // 独立背景开关事件
            subTitleBgToggle.addEventListener('click', () => {
                subTitleBgToggle.classList.toggle('active');
                updateIndividualBackground();
            });
            
            leftTitleBgToggle.addEventListener('click', () => {
                leftTitleBgToggle.classList.toggle('active');
                updateIndividualBackground();
            });
            
            leftContentBgToggle.addEventListener('click', () => {
                leftContentBgToggle.classList.toggle('active');
                updateIndividualBackground();
            });
            
            rightTitleBgToggle.addEventListener('click', () => {
                rightTitleBgToggle.classList.toggle('active');
                updateIndividualBackground();
            });
            
            rightContentBgToggle.addEventListener('click', () => {
                rightContentBgToggle.classList.toggle('active');
                updateIndividualBackground();
            });
            
            bottomTextBgToggle.addEventListener('click', () => {
                bottomTextBgToggle.classList.toggle('active');
                updateIndividualBackground();
            });
            
            // 背景框设置事件监听
            bgPaddingInput.addEventListener('input', () => {
                bgPaddingValue.textContent = bgPaddingInput.value + 'px';
                updateIndividualBackground();
            });
            
            bgRadiusInput.addEventListener('input', () => {
                bgRadiusValue.textContent = bgRadiusInput.value + 'px';
                updateIndividualBackground();
            });
            
            bgOpacityInput.addEventListener('input', () => {
                bgOpacityValue.textContent = bgOpacityInput.value;
                updateIndividualBackground();
            });
            
            // 左列延伸距离事件监听
            leftExtendInput.addEventListener('input', () => {
                leftExtendValue.textContent = leftExtendInput.value + '%';
                updateLeftExtend();
            });
            
            // 位置调整按钮事件监听
            positionBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    const target = btn.dataset.target;
                    const action = btn.dataset.action;
                    adjustPosition(target, action);
                });
            });
            
            // 关键词颜色事件监听
            keywordColorInput.addEventListener('input', () => {
                keywordColorPreview.style.background = keywordColorInput.value;
                updateMainTitle();
            });
            
            // 主标题颜色事件监听
            mainTitleColorInput.addEventListener('input', () => {
                updateMainTitle();
            });
            
            // 描边颜色和宽度事件监听
            strokeColorInput.addEventListener('input', () => {
                updateMainTitle();
            });
            
            strokeWidthInput.addEventListener('input', () => {
                updateMainTitle();
            });
            
            // 副标题颜色事件监听
            subTitleColorInput.addEventListener('input', () => {
                updateSubTitle();
            });
            
            // 左列标题颜色事件监听
            leftTitleColorInput.addEventListener('input', () => {
                updateLeftTitle();
            });
            
            // 左列内容颜色事件监听
            leftContentColorInput.addEventListener('input', () => {
                updateLeftContent();
            });
            
            // 右列标题颜色事件监听
            rightTitleColorInput.addEventListener('input', () => {
                updateRightTitle();
            });
            
            // 右列内容颜色事件监听
            rightContentColorInput.addEventListener('input', () => {
                updateRightContent();
            });
            
            // 底部文字颜色事件监听
            bottomTextColorInput.addEventListener('input', () => {
                updateBottomText();
            });
            
            // 添加保存按钮事件
            saveBtn.addEventListener('click', saveAsImage);
            
            // 添加重置按钮事件
            resetBtn.addEventListener('click', resetToDefault);
            
            // 初始更新
            updateContent();
            updateFontSizes();
            updateBackground();
            updatePattern();
            updateIndividualBackground();
            
            // 初始化顶部装饰条
            headerBar.style.background = headerColorInput.value;
            headerColorPreview.style.background = headerColorInput.value;
            
            // 初始化背景预览
            bgColorPreview.style.background = bgColorInput.value;
            contentBgColorPreview.style.background = contentBgColorInput.value;
            
            // 初始化背景框设置显示值
            bgPaddingValue.textContent = bgPaddingInput.value + 'px';
            bgRadiusValue.textContent = bgRadiusInput.value + 'px';
            bgOpacityValue.textContent = bgOpacityInput.value;
            leftExtendValue.textContent = leftExtendInput.value + '%';
            
            // 初始化手动位置偏移
            const savedOffset = parseInt(localStorage.getItem('bgFrameOffset') || '0');
            if (savedOffset !== 0) {
                setTimeout(() => applyBackgroundFrameOffset(savedOffset), 100);
            }
            
            // 初始化关键词颜色预览
            keywordColorPreview.style.background = keywordColorInput.value;
        }
        
        // 加载模板配置
        function loadTemplateConfig() {
            const templateConfig = localStorage.getItem('selectedTemplate');
            if (templateConfig) {
                try {
                    const config = JSON.parse(templateConfig);
                    
                    // 应用背景颜色
                    if (config.bgColor) {
                        bgColorInput.value = config.bgColor;
                        bgColorPreview.style.background = config.bgColor;
                        coverCard.style.background = config.bgColor;
                    }
                    
                    // 应用顶部装饰条颜色
                    if (config.headerColor) {
                        headerColorInput.value = config.headerColor;
                        headerColorPreview.style.background = config.headerColor;
                        headerBar.style.background = config.headerColor;
                    }
                    
                    // 应用文字颜色
                    if (config.mainTitleColor) {
                        mainTitleColorInput.value = config.mainTitleColor;
                    }
                    if (config.subTitleColor) {
                        subTitleColorInput.value = config.subTitleColor;
                    }
                    if (config.leftTitleColor) {
                        leftTitleColorInput.value = config.leftTitleColor;
                    }
                    if (config.leftContentColor) {
                        leftContentColorInput.value = config.leftContentColor;
                    }
                    if (config.rightTitleColor) {
                        rightTitleColorInput.value = config.rightTitleColor;
                    }
                    if (config.rightContentColor) {
                        rightContentColorInput.value = config.rightContentColor;
                    }
                    if (config.bottomTextColor) {
                        bottomTextColorInput.value = config.bottomTextColor;
                    }
                    if (config.keywordColor) {
                        keywordColorInput.value = config.keywordColor;
                        keywordColorPreview.style.background = config.keywordColor;
                    }
                    
                    // 应用背景图案
                    if (config.pattern && config.pattern !== 'none') {
                        patternOptions.forEach(opt => opt.classList.remove('active'));
                        const patternOption = document.querySelector(`[data-pattern="${config.pattern}"]`);
                        if (patternOption) {
                            patternOption.classList.add('active');
                            currentPattern = config.pattern;
                        }
                    }
                    
                    // 应用自定义背景图片
                    if (config.customBackgroundImage) {
                        coverCard.style.backgroundImage = `url(${config.customBackgroundImage})`;
                        coverCard.style.backgroundSize = 'cover';
                        coverCard.style.backgroundPosition = 'center';
                        coverCard.style.backgroundRepeat = 'no-repeat';
                    }
                    
                    // 清除localStorage中的模板配置
                    localStorage.removeItem('selectedTemplate');
                    
                    // 更新所有内容
                    updateContent();
                    updateFontSizes();
                    updateBackground();
                    updatePattern();
                    
                } catch (e) {
                    console.error('加载模板配置失败:', e);
                }
            }
        }
        
        // 重置为默认设置
        function resetToDefault() {
            // 重置内容
            mainTitleInput.value = "最*好用*的护肤品推荐｜*干皮*救星";
            subTitleInput.value = "拯救沙漠大干皮，24小时持久保湿不脱妆，让你拥有水光肌";
            leftTitleInput.value = "产品特点";
            leftContentInput.value = "✅ 72小时超长保湿\n✅ 天然植物成分\n✅ 敏感肌可用\n✅ 不油腻好吸收";
            rightTitleInput.value = "使用效果";
            rightContentInput.value = "✨ 上妆不卡粉\n✨ 改善起皮问题\n✨ 提亮肤色\n✨ 毛孔隐形";
            bottomTextInput.value = "点击收藏｜干皮必入｜#护肤推荐";
            
            // 重置字号
            mainTitleSizeInput.value = "43";
            subTitleSizeInput.value = "20";
            leftTitleSizeInput.value = "18";
            leftContentSizeInput.value = "12";
            rightTitleSizeInput.value = "18";
            rightContentSizeInput.value = "12";
            bottomTextSizeInput.value = "18";
            
            // 重置背景
            bgOptions.forEach(opt => opt.classList.remove('active'));
            document.querySelector('.bg-option[data-color="light-gray"]').classList.add('active');
            currentBgColor = 'light-gray';
            coverCard.style.background = '';
            
            // 重置顶部装饰条
            headerColorInput.value = "#ff3366";
            headerColorPreview.style.background = "#ff3366";
            headerBar.style.background = "#ff3366";
            
            // 重置背景颜色
            bgColorInput.value = "#ffffff";
            bgColorPreview.style.background = "#ffffff";
            
            // 重置背景框颜色
            contentBgColorInput.value = "#ffffff";
            contentBgColorPreview.style.background = "#ffffff";
            
            // 重置背景框设置
            bgPaddingInput.value = 12;
            bgPaddingValue.textContent = '12px';
            bgRadiusInput.value = 8;
            bgRadiusValue.textContent = '8px';
            bgOpacityInput.value = 0.8;
            bgOpacityValue.textContent = '0.8';
            leftExtendInput.value = 0;
            leftExtendValue.textContent = '0%';
            
            // 重置位置调整
            [previewMainTitle, previewSubTitle, contentGrid, previewBottomText].forEach(element => {
                element.style.transform = 'translateY(0px)';
            });
            
            // 重置关键词颜色
            keywordColorInput.value = '#ff3366';
            keywordColorPreview.style.background = '#ff3366';
            
            // 重置其他文字颜色
            mainTitleColorInput.value = '#333333';
            subTitleColorInput.value = '#333333';
            leftTitleColorInput.value = '#333333';
            leftContentColorInput.value = '#333333';
            rightTitleColorInput.value = '#333333';
            rightContentColorInput.value = '#333333';
            bottomTextColorInput.value = '#333333';
            
            // 重置图案
            patternOptions.forEach(opt => opt.classList.remove('active'));
            document.querySelector('.pattern-option[data-pattern="flower"]').classList.add('active');
            currentPattern = 'flower';
            decorations.forEach(dec => {
                dec.textContent = '❀';
            });
            
            // 重置自定义图案
            customPatternInput.value = '';
            
            // 重置独立背景开关
            subTitleBgToggle.classList.remove('active');
            leftTitleBgToggle.classList.remove('active');
            leftContentBgToggle.classList.remove('active');
            rightTitleBgToggle.classList.remove('active');
            rightContentBgToggle.classList.remove('active');
            bottomTextBgToggle.classList.remove('active');
            
            // 重置手动位置偏移
            localStorage.setItem('bgFrameOffset', '0');
            
            // 更新所有内容
            updateContent();
            updateFontSizes();
            updateBackground();
            updatePattern();
            updateIndividualBackground();
            updateLeftExtend();
        }
        
        // 更新内容
        function updateContent() {
            updateMainTitle();
            updateSubTitle();
            updateLeftTitle();
            updateLeftContent();
            updateRightTitle();
            updateRightContent();
            updateBottomText();
            
            // 检查板块是否需要显示
            updateBlockVisibility();
        }
        
        // 更新主标题
        function updateMainTitle() {
            const text = mainTitleInput.value;
            // 使用星号(*)分割关键词
            const parts = text.split('*');
            
            // 清空现有内容
            previewMainTitle.innerHTML = '';
            
            // 获取描边设置
            const strokeWidth = parseFloat(strokeWidthInput.value) || 0;
            const strokeColor = strokeColorInput.value;
            
            // 重新构建标题
            parts.forEach((part, index) => {
                const span = document.createElement('span');
                span.textContent = part;
                
                // 应用描边样式
                if (strokeWidth > 0) {
                    span.style.webkitTextStroke = `${strokeWidth}px ${strokeColor}`;
                    span.style.textShadow = `0 0 ${strokeWidth}px ${strokeColor}`;
                } else {
                    span.style.webkitTextStroke = 'none';
                    span.style.textShadow = 'none';
                }
                
                // 奇数索引部分为关键词（因为关键词在星号之间）
                if (index % 2 === 1) {
                    const keyword = document.createElement('span');
                    keyword.textContent = part;
                    keyword.style.color = keywordColorInput.value;
                    keyword.style.fontWeight = 'bold';
                    
                    // 为关键词也应用描边样式
                    if (strokeWidth > 0) {
                        keyword.style.webkitTextStroke = `${strokeWidth}px ${strokeColor}`;
                        keyword.style.textShadow = `0 0 ${strokeWidth}px ${strokeColor}`;
                    } else {
                        keyword.style.webkitTextStroke = 'none';
                        keyword.style.textShadow = 'none';
                    }
                    
                    previewMainTitle.appendChild(keyword);
                } else {
                    span.style.color = mainTitleColorInput.value;
                    previewMainTitle.appendChild(span);
                }
            });
        }
        
        // 更新其他文本内容
        function updateSubTitle() {
            previewSubTitle.textContent = subTitleInput.value;
            previewSubTitle.style.color = subTitleColorInput.value;
        }
        
        function updateLeftTitle() {
            previewLeftTitle.textContent = leftTitleInput.value;
            previewLeftTitle.style.color = leftTitleColorInput.value;
        }
        
        function updateLeftContent() {
            previewLeftContent.innerHTML = leftContentInput.value.replace(/\n/g, '<br>');
            previewLeftContent.style.color = leftContentColorInput.value;
        }
        
        function updateRightTitle() {
            previewRightTitle.textContent = rightTitleInput.value;
            previewRightTitle.style.color = rightTitleColorInput.value;
        }
        
        function updateRightContent() {
            previewRightContent.innerHTML = rightContentInput.value.replace(/\n/g, '<br>');
            previewRightContent.style.color = rightContentColorInput.value;
        }
        
        function updateBottomText() {
            previewBottomText.textContent = bottomTextInput.value;
            previewBottomText.style.color = bottomTextColorInput.value;
        }
        
        // 更新字体大小
        function updateFontSizes() {
            previewMainTitle.style.fontSize = `${mainTitleSizeInput.value}px`;
            previewSubTitle.style.fontSize = `${subTitleSizeInput.value}px`;
            previewLeftTitle.style.fontSize = `${leftTitleSizeInput.value}px`;
            previewLeftContent.style.fontSize = `${leftContentSizeInput.value}px`;
            previewRightTitle.style.fontSize = `${rightTitleSizeInput.value}px`;
            previewRightContent.style.fontSize = `${rightContentSizeInput.value}px`;
            previewBottomText.style.fontSize = `${bottomTextSizeInput.value}px`;
        }
        
        // 更新板块可见性
        function updateBlockVisibility() {
            // 显示/隐藏副标题
            previewSubTitle.style.display = subTitleInput.value.trim() ? 'block' : 'none';
            
            // 显示/隐藏左列区块
            const leftHasContent = leftTitleInput.value.trim() || leftContentInput.value.trim();
            leftBlock.style.display = leftHasContent ? 'block' : 'none';
            
            // 显示/隐藏右列区块
            const rightHasContent = rightTitleInput.value.trim() || rightContentInput.value.trim();
            rightBlock.style.display = rightHasContent ? 'block' : 'none';
            
            // 如果右列为空，左列自动扩展到全宽
            if (leftHasContent && !rightHasContent) {
                leftBlock.classList.add('full-width');
            } else {
                leftBlock.classList.remove('full-width');
            }
            
            // 显示/隐藏网格区块
            contentGrid.style.display = (leftHasContent || rightHasContent) ? 'grid' : 'none';
            
            // 显示/隐藏底部文字
            previewBottomText.style.display = bottomTextInput.value.trim() ? 'block' : 'none';
        }
        
        // 更新左列缩进距离
        function updateLeftExtend() {
            const extendValue = parseInt(leftExtendInput.value);
            const leftHasContent = leftTitleInput.value.trim() || leftContentInput.value.trim();
            const rightHasContent = rightTitleInput.value.trim() || rightContentInput.value.trim();
            
            // 只有当左列有内容且右列为空时才应用缩进效果
            if (leftHasContent && !rightHasContent && extendValue < 0) {
                // 负数值表示向内缩进，减少左列宽度
                const shrinkPercentage = Math.abs(extendValue);
                leftBlock.style.width = `${100 - shrinkPercentage}%`;
                leftBlock.style.marginLeft = `${shrinkPercentage / 2}%`;
            } else {
                leftBlock.style.width = '';
                leftBlock.style.marginLeft = '';
            }
            
            // 更新背景框以适应缩进变化
            updateIndividualBackground();
        }
        
        // 更新独立背景
        function updateIndividualBackground() {
            const bgColor = contentBgColorInput.value;
            const opacity = bgOpacityInput.value;
            const padding = bgPaddingInput.value + 'px';
            const radius = bgRadiusInput.value + 'px';
            const bgColorWithAlpha = hexToRgba(bgColor, opacity);
            
            // 检查左列缩进状态
            const extendValue = parseInt(leftExtendInput.value);
            const leftHasContent = leftTitleInput.value.trim() || leftContentInput.value.trim();
            const rightHasContent = rightTitleInput.value.trim() || rightContentInput.value.trim();
            const hasLeftShrink = leftHasContent && !rightHasContent && extendValue < 0;
            
            // 检查左列是否需要融合
            const leftTitleActive = leftTitleBgToggle.classList.contains('active');
            const leftContentActive = leftContentBgToggle.classList.contains('active');
            const rightTitleActive = rightTitleBgToggle.classList.contains('active');
            const rightContentActive = rightContentBgToggle.classList.contains('active');
            const shouldMergeLeft = leftTitleActive && leftContentActive;
            const shouldMergeRight = rightTitleActive && rightContentActive;
            
            if (shouldMergeLeft) {
                // 融合左列背景
                leftBlock.style.background = bgColorWithAlpha;
                leftBlock.style.padding = padding;
                leftBlock.style.borderRadius = radius;
                
                // 如果有缩进，调整背景框位置
                if (hasLeftShrink) {
                    const shrinkPercentage = Math.abs(extendValue);
                    leftBlock.style.marginLeft = `${shrinkPercentage / 2}%`;
                    leftBlock.style.width = `${100 - shrinkPercentage}%`;
                }
                
                // 清除单独的背景
                previewLeftTitle.style.background = 'transparent';
                previewLeftTitle.style.padding = '0';
                previewLeftTitle.style.borderRadius = '0';
                previewLeftTitle.style.marginBottom = '12px';
                
                previewLeftContent.style.background = 'transparent';
                previewLeftContent.style.padding = '0';
                previewLeftContent.style.borderRadius = '0';
            } else {
                // 清除融合背景
                leftBlock.style.background = 'transparent';
                leftBlock.style.padding = '18px';
                leftBlock.style.borderRadius = '12px';
                
                // 左列标题背景
                if (leftTitleActive) {
                    previewLeftTitle.style.background = bgColorWithAlpha;
                    previewLeftTitle.style.padding = padding;
                    previewLeftTitle.style.borderRadius = radius;
                    previewLeftTitle.style.marginBottom = '8px';
                    
                    // 如果有缩进，调整标题背景位置
                    if (hasLeftShrink) {
                        const shrinkPercentage = Math.abs(extendValue);
                        previewLeftTitle.style.marginLeft = `${shrinkPercentage / 2}%`;
                        previewLeftTitle.style.width = `${100 - shrinkPercentage}%`;
                    } else {
                        previewLeftTitle.style.marginLeft = '';
                        previewLeftTitle.style.width = '';
                    }
                } else {
                    previewLeftTitle.style.background = 'transparent';
                    previewLeftTitle.style.padding = '0';
                    previewLeftTitle.style.borderRadius = '0';
                    previewLeftTitle.style.marginBottom = '12px';
                    previewLeftTitle.style.marginLeft = '';
                    previewLeftTitle.style.width = '';
                }
                
                // 左列内容背景
                if (leftContentActive) {
                    previewLeftContent.style.background = bgColorWithAlpha;
                    previewLeftContent.style.padding = padding;
                    previewLeftContent.style.borderRadius = radius;
                    
                    // 如果有缩进，调整内容背景位置
                    if (hasLeftShrink) {
                        const shrinkPercentage = Math.abs(extendValue);
                        previewLeftContent.style.marginLeft = `${shrinkPercentage / 2}%`;
                        previewLeftContent.style.width = `${100 - shrinkPercentage}%`;
                    } else {
                        previewLeftContent.style.marginLeft = '';
                        previewLeftContent.style.width = '';
                    }
                } else {
                    previewLeftContent.style.background = 'transparent';
                    previewLeftContent.style.padding = '0';
                    previewLeftContent.style.borderRadius = '0';
                    previewLeftContent.style.marginLeft = '';
                    previewLeftContent.style.width = '';
                }
            }
            
            // 右列背景融合逻辑（与左列保持一致）
            if (shouldMergeRight) {
                // 融合右列背景
                rightBlock.style.background = bgColorWithAlpha;
                rightBlock.style.padding = padding;
                rightBlock.style.borderRadius = radius;
                
                // 清除单独的背景
                previewRightTitle.style.background = 'transparent';
                previewRightTitle.style.padding = '0';
                previewRightTitle.style.borderRadius = '0';
                previewRightTitle.style.marginBottom = '12px';
                
                previewRightContent.style.background = 'transparent';
                previewRightContent.style.padding = '0';
                previewRightContent.style.borderRadius = '0';
            } else {
                // 清除融合背景
                rightBlock.style.background = 'transparent';
                rightBlock.style.padding = '18px';
                rightBlock.style.borderRadius = '12px';
                
                // 右列标题背景
                if (rightTitleActive) {
                    previewRightTitle.style.background = bgColorWithAlpha;
                    previewRightTitle.style.padding = padding;
                    previewRightTitle.style.borderRadius = radius;
                    previewRightTitle.style.marginBottom = '8px';
                } else {
                    previewRightTitle.style.background = 'transparent';
                    previewRightTitle.style.padding = '0';
                    previewRightTitle.style.borderRadius = '0';
                    previewRightTitle.style.marginBottom = '12px';
                }
                
                // 右列内容背景
                if (rightContentActive) {
                    previewRightContent.style.background = bgColorWithAlpha;
                    previewRightContent.style.padding = padding;
                    previewRightContent.style.borderRadius = radius;
                } else {
                    previewRightContent.style.background = 'transparent';
                    previewRightContent.style.padding = '0';
                    previewRightContent.style.borderRadius = '0';
                }
            }
            
            // 副标题背景
            if (subTitleBgToggle.classList.contains('active')) {
                previewSubTitle.style.background = bgColorWithAlpha;
                previewSubTitle.style.padding = padding;
                previewSubTitle.style.borderRadius = radius;
            } else {
                previewSubTitle.style.background = 'transparent';
                previewSubTitle.style.padding = '0';
                previewSubTitle.style.borderRadius = '0';
            }
            
            // 底部文字背景
            if (bottomTextBgToggle.classList.contains('active')) {
                previewBottomText.style.background = bgColorWithAlpha;
                previewBottomText.style.padding = padding;
                previewBottomText.style.borderRadius = radius;
            } else {
                previewBottomText.style.background = 'transparent';
                previewBottomText.style.padding = '0';
                previewBottomText.style.borderRadius = '0';
            }
            
            // 应用手动位置偏移
            const savedOffset = parseInt(localStorage.getItem('bgFrameOffset') || '0');
            if (savedOffset !== 0) {
                applyBackgroundFrameOffset(savedOffset);
            }
        }
        
        // 将十六进制颜色转换为带透明度的rgba
        function hexToRgba(hex, alpha) {
            const r = parseInt(hex.slice(1, 3), 16);
            const g = parseInt(hex.slice(3, 5), 16);
            const b = parseInt(hex.slice(5, 7), 16);
            return `rgba(${r}, ${g}, ${b}, ${alpha})`;
        }
        
        // 更新背景颜色
        function updateBackground() {
            const card = document.querySelector('.card');
            
            // 清除内联样式
            card.style.background = '';
            
            // 移除所有背景类
            card.classList.remove('bg-light-gray', 'bg-transparent', 'bg-blue', 'bg-green', 'bg-purple', 
                                'bg-orange', 'bg-teal', 'bg-coral', 'bg-lavender', 'bg-mint',
                                'bg-peach', 'bg-sky', 'bg-sunset', 'bg-ocean', 'bg-lime', 'bg-berry');
            
            // 添加当前背景类
            card.classList.add(`bg-${currentBgColor}`);
        }
        
        // 更新背景图案
        function updatePattern() {
            decorations.forEach((dec, index) => {
                if (currentPattern === 'none') {
                    dec.style.display = 'none';
                } else {
                    dec.style.display = 'block';
                    
                    switch(currentPattern) {
                        case 'flower':
                            dec.textContent = '❀';
                            break;
                        case 'heart':
                            dec.textContent = '❤';
                            break;
                        case 'star':
                            dec.textContent = '★';
                            break;
                        case 'diamond':
                            dec.textContent = '◆';
                            break;
                        case 'circle':
                            dec.textContent = '●';
                            break;
                        case 'sun':
                            dec.textContent = '☀';
                            break;
                        case 'moon':
                            dec.textContent = '☽';
                            break;
                        case 'cloud':
                            dec.textContent = '☁';
                            break;
                        case 'snow':
                            dec.textContent = '❄';
                            break;
                        case 'music':
                            dec.textContent = '♫';
                            break;
                        case 'note':
                            dec.textContent = '♪';
                            break;
                        case 'leaf':
                            dec.textContent = '☘';
                            break;
                        case 'clover':
                            dec.textContent = '☘';
                            break;
                        case 'peace':
                            dec.textContent = '☮';
                            break;
                    }
                    
                    // 调整不同位置的图案大小
                    if (index === 0) {
                        dec.style.fontSize = '7rem';
                    } else if (index === 1) {
                        dec.style.fontSize = '5rem';
                    }
                }
            });
        }
        
        // 位置调整函数
        function adjustPosition(target, action) {
            let element;
            switch(target) {
                case 'main-title':
                    element = previewMainTitle;
                    break;
                case 'sub-title':
                    element = previewSubTitle;
                    break;
                case 'content':
                    element = contentGrid;
                    break;
                case 'bottom-text':
                    element = previewBottomText;
                    break;
                case 'bg-frame':
                    // 背景框位置调节
                    adjustBackgroundFramePosition(action);
                    return;
                default:
                    return;
            }
            
            const currentTransform = element.style.transform || 'translateY(0px)';
            const currentY = parseInt(currentTransform.match(/translateY\((-?\d+)px\)/) ? currentTransform.match(/translateY\((-?\d+)px\)/)[1] : 0);
            
            let newY = currentY;
            if (action === 'up') {
                newY -= 5;
            } else if (action === 'down') {
                newY += 5;
            }
            
            element.style.transform = `translateY(${newY}px)`;
        }
        
        // 背景框位置调节函数
        function adjustBackgroundFramePosition(action) {
            // 获取当前手动位置偏移值
            let currentOffset = parseInt(localStorage.getItem('bgFrameOffset') || '0');
            
            if (action === 'left') {
                currentOffset -= 5;
            } else if (action === 'right') {
                currentOffset += 5;
            } else if (action === 'reset') {
                currentOffset = 0;
            }
            
            // 限制偏移范围
            currentOffset = Math.max(-50, Math.min(50, currentOffset));
            
            // 保存偏移值
            localStorage.setItem('bgFrameOffset', currentOffset.toString());
            
            // 应用位置偏移
            applyBackgroundFrameOffset(currentOffset);
        }
        
        // 应用背景框位置偏移
        function applyBackgroundFrameOffset(offset) {
            // 只调节左列标题和内容背景框
            const elements = [
                leftBlock,
                previewLeftTitle,
                previewLeftContent
            ];
            
            elements.forEach(element => {
                if (element && element.style.background && element.style.background !== 'transparent') {
                    const currentTransform = element.style.transform || '';
                    const transformWithoutX = currentTransform.replace(/translateX\([^)]*\)\s*/g, '');
                    element.style.transform = `translateX(${offset}px) ${transformWithoutX}`.trim();
                }
            });
        }
        
        // 保存为图片
        function saveAsImage() {
            // 显示保存中提示
            const originalText = saveBtn.innerHTML;
            saveBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> 生成中...';
            saveBtn.disabled = true;
            
            // 使用html2canvas生成图片
            html2canvas(document.getElementById('coverCard'), {
                scale: 3, // 高清输出
                backgroundColor: null,
                logging: false
            }).then(canvas => {
                // 创建下载链接
                const link = document.createElement('a');
                link.download = '小红书封面.png';
                link.href = canvas.toDataURL('image/png');
                link.click();
                
                // 恢复按钮状态
                saveBtn.innerHTML = originalText;
                saveBtn.disabled = false;
            }).catch(err => {
                console.error('生成图片时出错:', err);
                saveBtn.innerHTML = originalText;
                saveBtn.disabled = false;
                showMessage('生成图片失败，请重试', 'error');
            });
        }
        
        // 自定义背景图片功能
        let customBackgroundImage = null;
        let currentImageSettings = {
            position: 'center',
            scale: 100,
            blur: 0,
            opacity: 1
        };
        
        function initCustomBackground() {
            const uploadArea = document.getElementById('uploadArea');
            const backgroundUpload = document.getElementById('backgroundUpload');
            const uploadPreview = document.getElementById('uploadPreview');
            const uploadContent = uploadArea.querySelector('.upload-content');
            const previewImage = document.getElementById('previewImage');
            const removeImageBtn = document.getElementById('removeImage');
            const bgImageControls = document.getElementById('bgImageControls');
            
            // 点击上传区域
            uploadArea.addEventListener('click', () => {
                if (!uploadPreview.style.display || uploadPreview.style.display === 'none') {
                    backgroundUpload.click();
                }
            });
            
            // 文件选择
            backgroundUpload.addEventListener('change', handleFileSelect);
            
            // 拖拽上传
            uploadArea.addEventListener('dragover', (e) => {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });
            
            uploadArea.addEventListener('dragleave', () => {
                uploadArea.classList.remove('dragover');
            });
            
            uploadArea.addEventListener('drop', (e) => {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    handleFile(files[0]);
                }
            });
            
            // 删除图片
            removeImageBtn.addEventListener('click', (e) => {
                e.stopPropagation();
                removeCustomBackground();
            });
            
            // 图片控制
            initImageControls();
        }
        
        function handleFileSelect(e) {
            const file = e.target.files[0];
            if (file) {
                handleFile(file);
            }
        }
        
        function handleFile(file) {
            if (!file.type.startsWith('image/')) {
                showMessage('请选择图片文件', 'error');
                return;
            }
            
            // 开始处理文件
            
            // 检查文件大小，超过2MB需要压缩
            if (file.size > 2 * 1024 * 1024) {
                // 文件过大，开始压缩
                
                // 显示压缩提示
                const uploadArea = document.getElementById('uploadArea');
                const originalContent = uploadArea.innerHTML;
                uploadArea.innerHTML = '<div class="upload-content"><div style="text-align: center; color: #666;"><div style="font-size: 24px; margin-bottom: 10px;">📷</div><div>正在压缩图片...</div><div style="font-size: 12px; margin-top: 5px;">大图片需要压缩以确保正常显示</div></div></div>';
                
                // 根据文件大小调整压缩参数
                let maxWidth = 1920, maxHeight = 1080, quality = 0.8;
                if (file.size > 10 * 1024 * 1024) {
                    // 超过10MB的文件使用更激进的压缩
                    maxWidth = 1280;
                    maxHeight = 720;
                    quality = 0.6;
                } else if (file.size > 5 * 1024 * 1024) {
                    // 超过5MB的文件使用中等压缩
                    maxWidth = 1600;
                    maxHeight = 900;
                    quality = 0.7;
                }
                
                compressImage(file, (compressedDataUrl) => {
                    customBackgroundImage = compressedDataUrl;
                    // 图片压缩完成
                    
                    // 恢复原始内容
                    uploadArea.innerHTML = originalContent;
                    
                    showImagePreview(compressedDataUrl);
                    applyCustomBackground();
                    showImageControls();
                });
            } else {
                const reader = new FileReader();
                reader.onload = (e) => {
                    customBackgroundImage = e.target.result;
                    // 文件读取完成
                    showImagePreview(e.target.result);
                    applyCustomBackground();
                    showImageControls();
                };
                reader.onerror = (e) => {
                    console.error('文件读取失败:', e);
                    showMessage('文件读取失败，请重试', 'error');
                };
                reader.readAsDataURL(file);
            }
        }
        
        // 图片压缩函数
        function compressImage(file, callback, maxWidth = 1920, maxHeight = 1080, quality = 0.8) {
            const reader = new FileReader();
            reader.onload = (e) => {
                const img = new Image();
                img.onload = () => {
                    const canvas = document.createElement('canvas');
                    const ctx = canvas.getContext('2d');
                    
                    // 计算压缩后的尺寸
                    let { width, height } = img;
                    
                    if (width > maxWidth || height > maxHeight) {
                        const ratio = Math.min(maxWidth / width, maxHeight / height);
                        width = Math.floor(width * ratio);
                        height = Math.floor(height * ratio);
                    }
                    
                    canvas.width = width;
                    canvas.height = height;
                    
                    // 绘制压缩后的图片
                    ctx.drawImage(img, 0, 0, width, height);
                    
                    // 转换为DataURL
                    const compressedDataUrl = canvas.toDataURL('image/jpeg', quality);
                    
                    // 图片压缩处理完成
                    
                    callback(compressedDataUrl);
                };
                img.onerror = () => {
                    console.error('图片加载失败');
                    showMessage('图片格式不支持或文件损坏', 'error');
                };
                img.src = e.target.result;
            };
            reader.onerror = () => {
                console.error('文件读取失败');
                showMessage('文件读取失败，请重试', 'error');
            };
            reader.readAsDataURL(file);
        }
        
        function showImagePreview(imageSrc) {
            const uploadContent = document.querySelector('.upload-content');
            const uploadPreview = document.getElementById('uploadPreview');
            const previewImage = document.getElementById('previewImage');
            
            uploadContent.style.display = 'none';
            uploadPreview.style.display = 'block';
            previewImage.src = imageSrc;
        }
        
        function removeCustomBackground() {
            const uploadContent = document.querySelector('.upload-content');
            const uploadPreview = document.getElementById('uploadPreview');
            const bgImageControls = document.getElementById('bgImageControls');
            const card = document.querySelector('.card');
            
            customBackgroundImage = null;
            uploadContent.style.display = 'flex';
            uploadPreview.style.display = 'none';
            bgImageControls.style.display = 'none';
            
            // 移除自定义背景类，恢复默认背景
            card.classList.remove('has-custom-bg');
            
            // 清除自定义背景相关的CSS变量
            card.style.removeProperty('--bg-image');
            card.style.removeProperty('--bg-size');
            card.style.removeProperty('--bg-position');
            card.style.removeProperty('--bg-repeat');
            card.style.removeProperty('--bg-filter');
            card.style.background = '';
            
            // 重置设置
            currentImageSettings = {
                position: 'center',
                scale: 100,
                blur: 0,
                opacity: 1
            };
            
            // 恢复原背景
            updateBackground();
        }
        
        function showImageControls() {
            const bgImageControls = document.getElementById('bgImageControls');
            bgImageControls.style.display = 'block';
        }
        
        function initImageControls() {
            // 位置控制
            const positionBtns = document.querySelectorAll('.bg-image-controls .pos-btn');
            positionBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    positionBtns.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentImageSettings.position = btn.dataset.position;
                    applyCustomBackground();
                });
            });
            
            // 缩放控制
            const scaleInput = document.getElementById('bgImageScale');
            const scaleValue = document.getElementById('bgImageScaleValue');
            scaleInput.addEventListener('input', () => {
                currentImageSettings.scale = parseInt(scaleInput.value);
                scaleValue.textContent = scaleInput.value + '%';
                applyCustomBackground();
            });
            
            // 模糊控制
            const blurInput = document.getElementById('bgImageBlur');
            const blurValue = document.getElementById('bgImageBlurValue');
            blurInput.addEventListener('input', () => {
                currentImageSettings.blur = parseInt(blurInput.value);
                blurValue.textContent = blurInput.value + 'px';
                applyCustomBackground();
            });
            
            // 透明度控制
            const opacityInput = document.getElementById('bgImageOpacity');
            const opacityValue = document.getElementById('bgImageOpacityValue');
            opacityInput.addEventListener('input', () => {
                currentImageSettings.opacity = parseFloat(opacityInput.value);
                opacityValue.textContent = Math.round(opacityInput.value * 100) + '%';
                applyCustomBackground();
            });
            
            // 快速效果
            const effectBtns = document.querySelectorAll('.effect-btn');
            effectBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    const effect = btn.dataset.effect;
                    applyQuickEffect(effect);
                });
            });
        }
        
        function applyQuickEffect(effect) {
            const scaleInput = document.getElementById('bgImageScale');
            const blurInput = document.getElementById('bgImageBlur');
            const opacityInput = document.getElementById('bgImageOpacity');
            
            switch(effect) {
                case 'blur':
                    blurInput.value = 5;
                    currentImageSettings.blur = 5;
                    document.getElementById('bgImageBlurValue').textContent = '5px';
                    break;
                case 'darken':
                    opacityInput.value = 0.6;
                    currentImageSettings.opacity = 0.6;
                    document.getElementById('bgImageOpacityValue').textContent = '60%';
                    break;
                case 'brighten':
                    opacityInput.value = 1;
                    currentImageSettings.opacity = 1;
                    document.getElementById('bgImageOpacityValue').textContent = '100%';
                    break;
                case 'reset':
                    scaleInput.value = 100;
                    blurInput.value = 0;
                    opacityInput.value = 1;
                    currentImageSettings = {
                        ...currentImageSettings,
                        scale: 100,
                        blur: 0,
                        opacity: 1
                    };
                    document.getElementById('bgImageScaleValue').textContent = '100%';
                    document.getElementById('bgImageBlurValue').textContent = '0px';
                    document.getElementById('bgImageOpacityValue').textContent = '100%';
                    break;
            }
            applyCustomBackground();
        }
        
        function applyCustomBackground() {
            if (!customBackgroundImage) return;
            
            const card = document.querySelector('.card');
            const { position, scale, blur, opacity } = currentImageSettings;
            
            // 应用自定义背景
            
            // 添加自定义背景类并清除默认背景
            card.classList.add('has-custom-bg');
            card.style.background = 'none';
            
            // 设置背景图片
            const bgImageUrl = `url(${customBackgroundImage})`;
            card.style.setProperty('--bg-image', bgImageUrl);
            
            // 设置背景尺寸
            if (scale === 100) {
                card.style.setProperty('--bg-size', 'cover');
            } else {
                card.style.setProperty('--bg-size', `${scale}%`);
            }
            card.style.setProperty('--bg-repeat', 'no-repeat');
            
            // 设置位置
            const positionMap = {
                'top-left': 'top left',
                'top-center': 'top center',
                'top-right': 'top right',
                'center-left': 'center left',
                'center': 'center center',
                'center-right': 'center right',
                'bottom-left': 'bottom left',
                'bottom-center': 'bottom center',
                'bottom-right': 'bottom right'
            };
            card.style.setProperty('--bg-position', positionMap[position] || 'center center');
            
            // 应用滤镜效果到::before伪元素
            let filters = [];
            if (blur > 0) {
                filters.push(`blur(${blur}px)`);
            }
            if (opacity < 1) {
                filters.push(`opacity(${opacity})`);
            }
            
            if (filters.length > 0) {
                card.style.setProperty('--bg-filter', filters.join(' '));
            } else {
                card.style.setProperty('--bg-filter', 'none');
            }
            
            // 自定义背景已应用
            
            // 背景应用完成
        }
        
        // 显示消息函数
        function showMessage(message, type = 'info') {
            const messageDiv = document.createElement('div');
            messageDiv.className = type === 'error' ? 'error-message' : 'success-message';
            messageDiv.textContent = message;
            
            const container = document.querySelector('.input-section');
            container.insertBefore(messageDiv, container.firstChild);
            
            setTimeout(() => {
                messageDiv.remove();
            }, 5000);
        }

        // 统一的背景更新函数
        function updateBackgroundWithCustom() {
            if (customBackgroundImage) {
                // 如果有自定义背景图片，应用自定义背景
                applyCustomBackground();
                // 使用自定义背景图片
            } else {
                // 没有自定义背景时使用默认背景
                updateBackground();
            }
        }
        
        // 初始化应用
        function initApp() {
            init();
            initCustomBackground();
        }
        
        window.onload = initApp;
    </script>
</body>
</html>